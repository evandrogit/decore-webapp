<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" xmlns:o="http://omnifaces.org/ui"
	template="/WEB-INF/template.xhtml">

	<ui:define name="title">#{registroComprasBean.compra.id == null ? 'Registrar Compra' : 'Informações da Compra'}</ui:define>

	<f:metadata>
		<f:viewAction action="#{registroComprasBean.inicializar}" />

		<f:viewParam name="id" value="#{registroComprasBean.compra.id}" />
		<f:viewAction action="#{registroComprasBean.buscar}"
			if="#{param.id ne null}" />
	</f:metadata>

	<ui:define name="content">
	
		<script src="https://cdn.jsdelivr.net/npm/scandit-sdk@5.x"></script>

		<style>
@media ( min-width :220px) {
	.parcela-unica.hide {
		max-height: 0;
		pointer-events: none;
		transition: max-height 0.3s ease-in-out;
		margin-bottom: 0px;
	}
	.parcela-unica {
		overflow: hidden;
		max-height: 300px;
		transition: max-height 1s ease-in-out;	
		margin-bottom: 5px;	
	}
	
	#confirmDialog .ui-panel .ui-panel-content {
	    padding: 6px 12px;
	}
    #confirmDialog .forma-pagamento.ui-selectonemenu {
	    width: 100% !important;
	    min-width: 100% !important;
	}
	#confirmDialog .forma-pagamento.ui-selectonemenu .ui-selectonemenu-label {
	    white-space: normal;
	}
	
	.layout-wrapper .layout-main .layout-content {
    	padding: 55px 17px 4px 17px;
    }
    .card {
	    padding: 0px;
	}
	
	body .ui-panel .ui-panel-content {
	    padding: 0px;
	}
    
	body .ui-autocomplete-panel {
	    /*width: 60% !important;*/
	    max-height: 250px;
    }
	.btn-barcode_.ui-button.ui-state-default {
    	display: none !important;  	
    }
	.btn-camera.ui-button.ui-state-default {
    	display: block !important;  
    	width: 35px;
    	height: 29px;	
    	float: right;
    }	
	 .busca-avancada .ui-autocomplete {
	    width:86.6%;
	}
	.busca-avancada .ui-inputtext {
	    width: 86.6%;
	}
	.busca-avancada.ui-panel .ui-panel-content {
		padding: 0px;
	}
	.entrada_ > .ui-inputtext {
	    color: #53ab5c;
	    font-weight: bold;
	}
	.ui-inputswitch {
   		width: 60px !important;
    }
    .ui-inputswitch .ui-inputswitch-handle {
    	width: 28px !important;
    }
    .ui-inputswitch .ui-inputswitch-off {
    	width: 32px !important;
    }
	#confirmDialog .ui-panelgrid .ui-panelgrid-cell:nth-child(2n) {
		text-align: end;
	}
	#confirmDialog .ui-datatable .ui-datatable-data>tr td.ui-editable-column input
		{
		text-align: right;
	}
	#confirmDialog .ui-panelgrid .ui-panelgrid-cell {
		padding: 2px 1px;
	}
	#confirmDialog.ui-dialog .ui-dialog-content {
		padding: 0px 12px 0px 12px !important;
	}
	#confirmDialog .ui-grid-responsive .ui-grid-row {
		display: flex;
	}
	
	#confirmDialog .ui-state-disabled {
    	opacity: 0.5;
    }
    
	#primeiraParc-dialog.ui-dialog .ui-dialog-content {
	    padding: 8px 19px;
	}
	
	#pagamentoPara-dialog.ui-dialog .ui-dialog-content {
	    padding: 8px 19px;
	}
	.panel-confirm.ui-panel .ui-panel-content {
		padding: 0px !important;
	}
	.panel-parcelas.hide {
		max-height: 0;
		pointer-events: none;
		transition: max-height 0.3s ease-in-out;
	}
	.panel-parcelas {
		overflow: hidden;
		max-height: 300px;
		transition: max-height 1s ease-in-out;
	}
	.panel-parcelas.ui-panel .ui-panel-content {
		padding: 2px 0px 2px 0px !important;
	}
	.ui-datatable tbody td {
		height: auto !important;
	}
	.btn-select.ui-button.ui-button-icon-only .ui-icon {
		margin-top: -8px;
		font-size: 18px;
		color: #0f5baf;
	}
	.produtosTable .btn-select.ui-button {
		height: 30px;
		width: 30px;
		background-color: transparent;
		border: 1px solid #0f5baf;
		border-radius: 50px;
	}
	.produtosTable .btn-select.ui-button:hover {
		background-color: #e0dada;
	}
	.ui-datatable-scrollable-body {
		overflow: auto;
		max-height: 420px;
	}
	.itens-add {
		margin-top: -15px;
	}
	
	.panel-info .ui-panel-content {
	    padding: 0px !important;
	}
	
	body .ui-panel .ui-panel-content {
		border: none;
	}
	.ui-blockui-content {
		padding: 0.25em;
	}
	.ui-slider .ui-slider-handle {
		width: 1.7em;
		height: 1.7em;
	}
	.ui-slider-horizontal {
		height: 1.2em !important;
	}
	body .ui-fluid .ui-trigger-calendar .ui-datepicker-trigger.ui-button {
		height: 28px !important;
	}
	.result .apply-result .ui-grid-responsive .ui-grid-col-4 {
		width: 50% !important;
		float: left !important;
	}
	.result .apply-result .ui-grid-responsive .ui-grid-col-6 {
		width: 50% !important;
		float: left !important;
	}
	.qty-parcelas.ui-panelgrid .ui-panelgrid-cell:nth-child(1) {
		margin-top: 10px !important;
	}
	.percentual-juros.ui-panelgrid .ui-panelgrid-cell:nth-child(1) {
		margin-top: 8px !important;
	}
	.ui-datatable thead th, .ui-datatable tbody td, .ui-datatable tfoot td,
		.ui-datatable tfoot th {
		font-size: 13px;
	}
	body .btn-new.ui-button { 
    	width: 35px;
    	height: 29px;	
    	float: right;
	}
	.swal2-popup {
		width: 28em;
		max-width: 100%;
		padding: 0 0 0.4em 0;
		font-size: 0.75rem;
	}
	.swal2-popup #swal2-content {
		font-weight: 400;
	}
	body #item-dialog.ui-dialog .ui-dialog-content {
		background-color: #ffffff;
		padding: 10px 0px 0px 0px;
	}
	body .ui-datatable .ui-paginator {
		padding: 2px 0px !important;
	}
}

@media ( min-width :460px) {
	body .ui-button.ui-button-text-icon-left .ui-icon {
	    margin-top: -8px;
	    font-size: 16px;
	}
	#confirmDialog .forma-pagamento.ui-selectonemenu {
   		width: 100% !important;
   		min-width: 100% !important;
    }	
	body .ui-autocomplete-panel {
	    /*width: auto !important;*/
	    height: auto;
    }
	.busca-avancada .ui-autocomplete {
	    width: 84.7%;
	}
	.btn-barcode_.ui-button.ui-state-default {
    	display: block !important;  	
    }
	.btn-camera.ui-button.ui-state-default {
    	display: none !important;  	
    }
	.ui-slider .ui-slider-handle {
		width: 1.7em;
		height: 1.7em;
	}
	.ui-slider-horizontal {
		height: 1.2em;
	}
	body .ui-fluid .ui-trigger-calendar .ui-datepicker-trigger.ui-button {
		height: 27px !important;
	}
	.ui-datatable thead th, .ui-datatable tbody td, .ui-datatable tfoot td,
		.ui-datatable tfoot th {
		font-size: 14px;
	}
}

@media ( min-width :640px) {
	.busca-avancada .ui-inputtext {
	    width: 84.7%;
	}
	.ui-slider-handle {
		width: 1.2em !important;
		height: 1.2em !important;
	}
	.ui-slider-horizontal {
		height: 0.8em !important;
	}
	body .ui-fluid .ui-trigger-calendar .ui-datepicker-trigger.ui-button {
		height: 27px !important;
	}
	.result .apply-result .ui-grid-responsive .ui-grid-col-4 {
		width: 33.33333% !important;
		float: none;
	}
	.result .apply-result .ui-grid-responsive .ui-grid-col-6 {
		width: auto !important;
		float: none;
	}
	.itens-add {
		margin-top: 15px;
	}
	.ui-datatable tbody td {
		height: 28px !important;
	}
}

@media ( min-width :641px) {
	.ui-datatable-scrollable-body {
		overflow: auto;
		max-height: 265px;
	}
}
</style>

		<div class="page-header">
			<h1>#{registroComprasBean.compra.id == null ? 'Registrar Compra'
				: 'Informações da Compra'}</h1>
		</div>

		<p:growl id="msg" closable="true" life="2000" showSummary="false"
			showDetail="true" style="text-align: center" />

		<div class="ui-g-12 ui-lg-12 card" style="margin-top: -10px;margin-bottom:30px;">

			<h:form id="form">							

				<p:panelGrid columns="2" layout="grid" style="margin-bottom: 5px"
					styleClass="panelgrid-noborder disabled disabled"
					columnClasses="ui-grid-col-6, ui-grid-col-6">

					<p:panel class="card card-w-title ui-fluid" id="panel-itens"
						style="margin-bottom: 0px;padding-bottom: 0px !important">

						<h3 style="font-weight: bold">Dados da Compra</h3>

						<p:panelGrid columns="2" layout="grid" style="margin-bottom: 5px"
							styleClass="panelgrid-noborder disabled disabled"
							columnClasses="ui-grid-col-4, ui-grid-col-4">

							<p:outputLabel value="Compra N." />
							<p:inputText value="#{registroComprasBean.compra.numeroCompra}"
								readonly="true" placeholder="Gerado automaticamente." />

							<p:outputLabel value="Data da Compra" for="data-compra" />
							<p:datePicker value="#{registroComprasBean.compra.dataCompra}"
								id="data-compra" pattern="dd/MM/yyyy" locale="pt"
								readonlyInput="true" showIcon="true" />

							<p:outputLabel value="Comprador" for="comprador" />
							<p:selectOneMenu id="comprador"
								value="#{registroComprasBean.compra.usuario}"
								placeholder="selecione">

								<f:selectItem itemLabel="Selecione" />

								<f:selectItems value="#{registroComprasBean.todosUsuarios}"
									var="vendedor" itemLabel="#{vendedor.nome}"
									itemValue="#{vendedor}" />
							</p:selectOneMenu>
						</p:panelGrid>
						
						<p:panelGrid style="display:none;" columns="2" layout="grid" id="panel-ajuste" rendered="#{seguranca.acessoAdministrador() or seguranca.acessoUsuarioAvancado()}"
							styleClass="panelgrid-noborder disabled disabled panel-ajuste"
							columnClasses="ui-grid-col-4, ui-grid-col-4">

							<p:outputLabel value="Atualizar Custo Médio?" for="ajuste" style="font-size: 13px;" />
							<p:selectBooleanCheckbox id="ajuste"
								value="#{registroComprasBean.compra.ajuste}"
								disabled="#{registroComprasBean.compra.id != null}">
								
								<p:ajax process="@this" update="@parent" />
							</p:selectBooleanCheckbox>	
						</p:panelGrid>

						<p:panelGrid columns="2" layout="grid" style="margin-bottom: 5px"
							styleClass="panelgrid-noborder disabled disabled"
							rendered="false" columnClasses="ui-grid-col-4, ui-grid-col-4">

							<p:outputLabel value="Quantidade de itens" for="itens" />
							<p:inputNumber id="itens" decimalPlaces="0" readonly="true"
								placeholder="0"
								value="#{registroComprasBean.compra.quantidadeItens}" />

							<p:outputLabel value="Valor total" for="total" />
							<p:inputNumber id="total" decimalPlaces="0" readonly="true"
								placeholder="0" value="#{registroComprasBean.compra.valorTotal}" />
						</p:panelGrid>
			
				<p:panel class="card card-w-title ui-fluid panel-info" id="panel-itens_"
						style="margin-bottom: 0px;margin-top: 30px; padding-bottom: 0px !important">
						
						<h3 style="font-weight: bold">Itens da compra</h3>

													
					
						
							<p:selectBooleanButton id="leitor" 
								value="#{registroComprasBean.leitor}" onLabel="ATIVADO"
								offLabel="DESATIVADO" onIcon="fa fa-fw fa-check"
								offIcon="fa fa-fw fa-close" style="position: relative; float: right; margin-top: -38px; margin-right: 8px; font-size:11px;width:105px;">
								
								<p:ajax process="@this" update="panel-busca" listener="#{registroComprasBean.ativarLeitor}" />										
							</p:selectBooleanButton>
							
							<p:outputLabel value="Leitor de código de barras" for="leitor" style="font-size: 12px;margin-top: -60px; margin-right: 8px;position: relative; float: right;" />
													
						<p:inputText id="id" type="hidden"
							value="#{registroComprasBean.itemCompra.code}" required="true"
							requiredMessage="Produto deve ser informado." />											
									
						<p:focus for="busca" rendered="#{registroComprasBean.itemCompra.produto.id == null and not registroComprasBean.leitor}" />
						<p:focus for="busca-por-leitor" rendered="#{registroComprasBean.itemCompra.produto.id == null and registroComprasBean.leitor}" />
									
						<p:focus id="focus-valor-unitario" for="valor-unitario" rendered="#{registroComprasBean.itemCompra.produto.id != null}"  />
							
						<p:defaultCommand scope="panel-itens_" target="btn-adicionar" id="default-busca"
									rendered="#{registroComprasBean.itemCompra.produto.id != null}" />	
									
						<p:panelGrid columns="2" layout="grid" style="margin-bottom: 5px"
							styleClass="panelgrid-noborder disabled disabled" id="panel-busca"
							columnClasses="ui-grid-col-4, ui-grid-col-8">
							
									<p:outputLabel value="Buscar Produto" />
							
									<p:panel styleClass="busca-avancada">
							
										<p:autoComplete id="busca" value="#{registroComprasBean.produto}" 
											placeholder="Digite o código ou descrição do produto"
											var="produto" styleClass="busca" rendered="#{not registroComprasBean.leitor}"
											itemLabel="#{produto.codigo.concat(' | ').concat(produto.descricao)}" itemValue="#{produto}"
											completeMethod="#{registroComprasBean.completeText_Produto}">
											
											<p:ajax event="itemSelect" listener="#{registroComprasBean.onItemSelect}" 
												update="panel-itens_ form:id form:codigo form:descricao form:fornecedor form:valor-unitario form:quantidade form:quantidade_ form:quantidade__ form:valor-total" />
										</p:autoComplete>
										
										<p:inputText id="busca-por-leitor" value="#{registroComprasBean.filter.codigo}" styleClass="field-barcode busca-por-leitor"
											placeholder="Escaneie ou digite o código do produto" rendered="#{registroComprasBean.leitor}" />
											
										<p:commandButton id="btn-barcode" icon="fa fa-fw fa-barcode" rendered="#{registroComprasBean.leitor}"
											action="#{registroComprasBean.pesquisar_}" process="@this busca-por-leitor"
											update="panel-itens_ form:id form:codigo form:descricao form:fornecedor form:valor-unitario form:quantidade form:quantidade_ form:quantidade__ form:valor-total" 
											style="float:right;width:35px;height:29px" styleClass="white-button btn-barcode btn-barcode_" />
										
										
										<p:commandButton id="enter-barcode" icon="fa fa-fw fa-camera-retro"  rendered="#{registroComprasBean.leitor}"
											onstart="readBarcode();" disabled="#{not seguranca.acessoAdministrador() and not seguranca.acessoUsuarioAvancado()}"
											oncomplete="PF('barcode-dialog').show();" styleClass="btn-camera white-button white-button_" />
										
									
										<p:commandButton styleClass="btn-new" icon="fa fa-fw fa-cubes"
											title="Buscar produto" onstart="PF('downloadLoading').show();"
											oncomplete="PF('downloadLoading').hide();PF('item-dialog').show()"
											process="@this" rendered="#{not registroComprasBean.leitor}" 
											disabled="#{not seguranca.acessoAdministrador() and not seguranca.acessoUsuarioAvancado()}" />
										
									
									</p:panel>
																
						</p:panelGrid>
										
										
						
						
										

						<p:panelGrid columns="2" layout="grid" style="margin-bottom: 5px"
							styleClass="panelgrid-noborder disabled disabled"
							columnClasses="ui-grid-col-4, ui-grid-col-4">

							<p:outputLabel value="Código" for="codigo" />
							<p:inputText id="codigo"
								value="#{registroComprasBean.itemCompra.produto.codigo}"
								readonly="true" />
						</p:panelGrid>
						
						<p:panelGrid columns="2" layout="grid" style="margin-top:-4px;margin-bottom: 0px"
							styleClass="panelgrid-noborder disabled disabled"
							columnClasses="ui-grid-col-4, ui-grid-col-6">

							<p:outputLabel value="Descrição" for="descricao" />
							<p:inputTextarea id="descricao"
								value="#{registroComprasBean.itemCompra.produto.descricao}"
								readonly="true" />
						</p:panelGrid>
						
						<p:panelGrid columns="2" layout="grid" style="margin-top:-4px;margin-bottom: 0px"
							styleClass="panelgrid-noborder disabled disabled" rendered="false"
							columnClasses="ui-grid-col-4, ui-grid-col-4">
							
							<p:outputLabel value="Fornecedor" for="fornecedor" />
							<p:inputText id="fornecedor"
								value="#{registroComprasBean.itemCompra.produto.fornecedor.nome}"
								readonly="true" />
						</p:panelGrid>
						
						
						<p:panelGrid columns="2" layout="grid" style="margin-top:-4px;margin-bottom: 0px"
							styleClass="panelgrid-noborder disabled disabled" rendered="false"
							columnClasses="ui-grid-col-4, ui-grid-col-4">
							
								<p:outputLabel value="Preço Médio de Compra" />
								<p:inputNumber decimalPlaces="2" 
									placeholder="R$ 0,00" symbol="R$ " 
									value="#{registroComprasBean.itemCompra.produto.precoMedioCompra}">
								</p:inputNumber>
								
						</p:panelGrid>


						<p:panelGrid columns="2" layout="grid" 
							styleClass="panelgrid-noborder disabled disabled"
							columnClasses="ui-grid-col-4, ui-grid-col-4">

							<p:outputLabel value="Valor Unitário" for="valor-unitario" />
							<p:inputNumber id="valor-unitario" decimalPlaces="4" onkeyup="ajaxDelay()"
								placeholder="R$ 0,0000" symbol="R$ " styleClass="valor-unitario"
								value="#{registroComprasBean.itemCompra.valorUnitario}">
								
								<p:ajax event="keydown" update="btn-adicionar"></p:ajax>
							</p:inputNumber>

							<p:outputLabel value="Quantidade (Un)" for="quantidade" rendered="#{registroComprasBean.itemCompra.produto == null}" />
							<p:outputLabel value="Quantidade (#{registroComprasBean.itemCompra.produto.unidadeMedida})" for="quantidade" rendered="#{registroComprasBean.itemCompra.produto != null}" />
							
							<p:inputNumber id="quantidade" decimalPlaces="0" placeholder="0"
								styleClass="quantidade" onkeyup="ajaxDelayQtd()"
								value="#{registroComprasBean.itemCompra.quantidade}"
								rendered="#{registroComprasBean.itemCompra.produto.unidadeMedida == 'Un' or registroComprasBean.itemCompra.produto.unidadeMedida == 'Cx' or registroComprasBean.itemCompra.produto == null}">

								<p:ajax event="keydown" update="btn-adicionar"></p:ajax>
							</p:inputNumber>
							
							<p:inputNumber id="quantidade_" decimalPlaces="3" placeholder="0,000"
								styleClass="quantidade_" onkeyup="ajaxDelayQtd_()"
								value="#{registroComprasBean.itemCompra.quantidade}"
								rendered="#{registroComprasBean.itemCompra.produto.unidadeMedida == 'Kg' or registroComprasBean.itemCompra.produto.unidadeMedida == 'Lt'}">

								<p:ajax event="keydown" update="btn-adicionar"></p:ajax>
							</p:inputNumber>
							
							<p:inputNumber id="quantidade__" decimalPlaces="1" placeholder="0,0"
								styleClass="quantidade__" onkeyup="ajaxDelayQtd__()"
								value="#{registroComprasBean.itemCompra.quantidade}"
								rendered="#{registroComprasBean.itemCompra.produto.unidadeMedida == 'Pt'}">

								<p:ajax event="keydown" update="btn-adicionar"></p:ajax>
							</p:inputNumber>

							<p:outputLabel value="Sub-Total" for="valor-total" />
							<p:inputNumber id="valor-total" decimalPlaces="2" readonly="true"
								styleClass="sub-total" placeholder="R$ 0,00" symbol="R$ "
								value="#{registroComprasBean.itemCompra.total}" />
						</p:panelGrid>
						
						<p:panelGrid columns="2" layout="grid" style="margin-bottom: 5px"
							styleClass="panelgrid-noborder disabled disabled" rendered="false"
							columnClasses="ui-grid-col-4, ui-grid-col-4">	
							
								<p:outputLabel value="Custo Médio Unitário" />
								<p:inputNumber decimalPlaces="2" 
									placeholder="R$ 0,00" symbol="R$ " 
									value="#{registroComprasBean.itemCompra.valorUnitario}">
								</p:inputNumber>
						</p:panelGrid>
								
						<p:panelGrid columns="2" layout="grid" style="margin-top:15px;margin-bottom: 5px"
							styleClass="panelgrid-noborder disabled disabled" rendered="false"
							columnClasses="ui-grid-col-4, ui-grid-col-4">
								
							<p:outputLabel value="Margem de Lucro (%)" />
							<p:panel style="text-align: center" id="panel-lucro">
							
								<h:outputText id="lucroEmDinheiro" styleClass="lucro-em-dinheiro"
									value="#{cadastroProdutoBean.produto.custoMedioUnitario * cadastroProdutoBean.produto.margemLucro/100}" 
									style="font-weight: bold;font-size: 10px;float: right;margin-top: -17px;margin-right: 6px;color: #757575;">
									
									<f:convertNumber type="currency" maxFractionDigits="4" />
								</h:outputText>
								
								<h:outputText id="margem-lucro2"
									value="%#{cadastroProdutoBean.produto.margemLucroReal}"
									style="font-weight: bold; font-size: 18px" />	
								<p:inputNumber id="percentual-lucro"  thousandSeparator="," decimalSeparator="." symbol="% "
									value="#{cadastroProdutoBean.produto.margemLucroReal}" disabled="#{cadastroProdutoBean.produto.quantidadeAtual le 0}">
									
									<p:ajax event="blur" 
										listener="#{cadastroProdutoBean.calculaMargemContribuicao_}" />
								</p:inputNumber>
								<p:slider for="percentual-lucro" display="margem-lucro2"  
									displayTemplate="%{value}" minValue="0" maxValue="80" step="0.01"
									disabled="#{cadastroProdutoBean.produto.quantidadeAtual le 0}">

									<p:ajax event="slideEnd" 
										listener="#{cadastroProdutoBean.calculaMargemContribuicao_}" />
								</p:slider>
							</p:panel>
								
								
								
								<p:outputLabel value="Preço de Venda" />
								<p:inputNumber decimalPlaces="2" 
									placeholder="R$ 0,00" symbol="R$ " 
									value="#{registroComprasBean.itemCompra.valorUnitario}">
								</p:inputNumber>								
								
						</p:panelGrid>

						<p:panelGrid columns="2" layout="grid"
							styleClass="panelgrid-noborder disabled disabled"
							columnClasses="ui-grid-col-4, ui-grid-col-4">

							<p:outputLabel />
							<p:commandButton id="btn-adicionar" value="Adicionar"
								onstart="PF('downloadLoading').show();" icon="fa fa-plus"
								onsuccess="PF('downloadLoading').hide();"
								disabled="#{not seguranca.acessoAdministrador() and not seguranca.acessoUsuarioAvancado()}"
								update="panel-itens_ msg codigo descricao fornecedor total-compra id valor-unitario quantidade quantidade_ quantidade__  valor-total panel-table"
								action="#{registroComprasBean.adicionarItem}"
								process="@this codigo valor-unitario quantidade quantidade_ quantidade__ valor-total id"
								style="font-weight: bold;" />
						</p:panelGrid>
					</p:panel>
</p:panel>

					<p:panel class="card card-w-title ui-fluid itens-add"
						id="panel-table" style="padding-bottom: 0px !important">

						<h3 style="font-weight: bold">Itens adicionados</h3>

						<p:panelGrid columns="1" layout="grid"
							styleClass="panelgrid-noborder disabled disabled"
							columnClasses="ui-grid-col-12">


							<p:dataTable id="itensTable" paginatorAlwaysVisible="false"
								scrollable="true" value="#{registroComprasBean.itensCompra}"
								var="item" emptyMessage="Nenhum item adicionado." reflow="true"
								paginator="false" rowKey="#{item.code}"
								selection="#{registroComprasBean.itemSelecionado}"
								selectionMode="single">

								<p:column headerText="Cód." width="20%">
									<h:outputText value="#{item.produto.codigo}" />
								</p:column>

								<p:column headerText="Desc." width="20%">
									<h:outputText value="#{item.produto.descricao}" />
								</p:column>

								<p:column headerText="Val. Unit." width="20%">
									<h:outputText value="#{item.valorUnitario}">
										<f:convertNumber type="currency" minFractionDigits="4" />
									</h:outputText>
								</p:column>

								<p:column headerText="Qtd" width="20%">
									<h:outputText value="#{item.quantidade}" rendered="#{item.produto.unidadeMedida == 'Kg' or item.produto.unidadeMedida == 'Lt'}">
										<f:convertNumber minFractionDigits="3" />
									</h:outputText>
									
									<h:outputText value=" #{item.produto.unidadeMedida}" rendered="#{(item.produto.unidadeMedida == 'Kg' or item.produto.unidadeMedida == 'Lt')}">
									</h:outputText>
									
									
									<h:outputText value="#{item.quantidade}" rendered="#{item.produto.unidadeMedida == 'Pt'}">
										<f:convertNumber minFractionDigits="1" />
									</h:outputText>
									
									<h:outputText value=" #{item.produto.unidadeMedida}" rendered="#{item.produto.unidadeMedida == 'Pt'}">
									</h:outputText>
									
									
									<h:outputText value="#{item.quantidade}" rendered="#{(item.produto.unidadeMedida != 'Kg' and item.produto.unidadeMedida != 'Lt' and item.produto.unidadeMedida != 'Pt')}">
										<f:convertNumber minFractionDigits="0" />
									</h:outputText>
									
									<h:outputText value=" #{item.produto.unidadeMedida}" rendered="#{(item.produto.unidadeMedida != 'Kg' and item.produto.unidadeMedida != 'Lt' and item.produto.unidadeMedida != 'Pt')}">
									</h:outputText>
								</p:column>

								<p:column headerText="Total" width="20%">
									<h:outputText value="#{item.total}">
										<f:convertNumber type="currency" />
									</h:outputText>
								</p:column>
							</p:dataTable>
						</p:panelGrid>

						<p:contextMenu id="menu-item" for="itensTable">
							<p:menuitem value="Remover Item" id="btn-remove"
								update="panel-table panel-itens_ total-compra" process="@this panel-table"
								action="#{registroComprasBean.removeItem}" onstart="start();"
								oncomplete="stop();" icon="fa fa-fw fa-trash"
								disabled="#{registroComprasBean.itensCompraSize eq 0}" />

							<p:menuitem value="Editar Item" id="btn-editar"
								update="panel-table panel-itens_ default-busca form:total-compra form:id form:codigo form:descricao form:fornecedor form:valor-unitario form:quantidade form:quantidade_ form:quantidade__ form:valor-total"
								process="@this panel-table"
								action="#{registroComprasBean.editarItem}" onstart="start();"
								oncomplete="stop();" icon="fa fa-fw fa-edit"
								disabled="#{registroComprasBean.itensCompraSize eq 0}" />
						</p:contextMenu>

						<p:panelGrid columns="2"  style="margin-top: 5px;float: right; margin-right: 10px;margin-bottom: 10px;"
							styleClass="panelgrid-noborder disabled disabled">
							<p:outputLabel value="Total: " />
							<p:outputLabel id="total-compra"
								value="#{registroComprasBean.compra.valorTotal}"
								style="margin-bottom:5px; font-weight:bold;margin-left:8px;color:#5b5656">

								<f:convertNumber type="currency" />
							</p:outputLabel>
						</p:panelGrid>

						<div
							style="width: 80%; margin-left: 10%; margin-top: 18px; margin-bottom: 10px; border-top: 1px solid #ccc"></div>

						<p:panelGrid columns="2" layout="grid"
							styleClass="panelgrid-noborder disabled disabled"
							columnClasses="ui-grid-col-4, ui-grid-col-3">

							<p:commandButton id="btn-calcular" value="Salvar Compra"
								onstart="PF('downloadLoading').show();" icon="fa fa-save"
								onsuccess="PF('downloadLoading').hide();"
								disabled="#{not seguranca.acessoAdministrador() and not seguranca.acessoUsuarioAvancado()}"
								update="msg confirmDialog panel-ajuste data-compra comprador panel-table form:id form:codigo form:descricao form:fornecedor form:valor-unitario form:quantidade form:quantidade_ form:quantidade__ form:valor-total"
								action="#{registroComprasBean.salvar}"
								process="@this panel-table data-compra comprador"
								style="font-weight: bold; margin-bottom: 10px;background-color: #0d8819b5;" />
						</p:panelGrid>

					</p:panel>

				</p:panelGrid>
			</h:form>

		</div>

		<p:dialog header="Buscar produto" widgetVar="item-dialog"
			position="top" style="margin-top: 100px" id="item-dialog"
			resizable="false" modal="true" closeOnEscape="true" responsive="true"
			width="350px">

			<h:form id="form-dialog">

				<div class="ui-g-12 ui-lg-12">
					<p:panel class="card card-w-title ui-fluid"
						style="padding-bottom: 0px;">

						<p:defaultCommand target="pesquisar-button" />

						<p:inputText id="search"
							value="#{registroComprasBean.filter.descricao}"
							placeholder="Digite o código ou descrição" style="width: 180px" />
						<p:commandButton icon="fa fa-fw fa-search" title="Pesquisar"
							id="pesquisar-button" update="produtosTable"
							style="margin-left: 3px; width: 40px" process="@parent"
							action="#{registroComprasBean.pesquisar}"
							onstart="PF('downloadLoading').show();"
							oncomplete="PF('downloadLoading').hide();">
						</p:commandButton>

						<p:dataTable id="produtosTable" paginatorAlwaysVisible="false"
							scrollable="true" scrollHeight="337"
							value="#{registroComprasBean.produtosFiltrados}" var="produto"
							emptyMessage="Nenhum produto encontrado." paginator="false"
							styleClass="produtosTable"
							style="margin-top: 10px;border: 1px solid #147df0;">

							<p:column headerText="Código" width="30%">
								<h:outputText value="#{produto.codigo}" />
							</p:column>

							<p:column headerText="Descrição" width="60%">
								<h:outputText value="#{produto.descricao}" />
							</p:column>

							<p:column width="20%" style="text-align: center">
								<p:commandButton icon="fa fa-fw fa-check"
									action="#{registroComprasBean.selecionarProduto(produto)}"
									title="Selecionar Produto"
									update="form:panel-itens_ form:id form:codigo form:descricao form:fornecedor form:valor-unitario form:quantidade form:quantidade_ form:quantidade__ form:valor-total"
									styleClass="btn-select" process="@this"
									onstart="PF('downloadLoading').show();"
									oncomplete="PF('downloadLoading').hide();PF('item-dialog').hide();">
								</p:commandButton>
							</p:column>

						</p:dataTable>
						
						<div
						style="width: 80%; margin: auto; border-top: 1px solid #ccc; margin-top: 10px; margin-bottom: 10px"></div>

						<p:commandButton icon="fa fa-fw fa-close" styleClass="btn-close"
							style="margin-bottom: 5px;font-weight: bold;width: 100px;background:#e15e5ef0;float: right;"
							value="Fechar"
							onstart="PF('downloadLoading').show();" 
							oncomplete="PF('downloadLoading').hide();PF('item-dialog').hide();">
						</p:commandButton>
					</p:panel>
				</div>

			</h:form>
		</p:dialog>

		<p:dialog header="Confirmação de pagamento" widgetVar="confirmDialog"
			position="top" style="margin-top: 100px;" id="confirmDialog" 
			resizable="false" modal="true" closeOnEscape="true" responsive="true"
			width="350px">

			<h:form id="confirm-dialog" style="margin-top: 10px;">

				<div class="ui-g-12 ui-lg-12">
					<p:panel class="card card-w-title ui-fluid"
						style="padding-bottom: 0px;margin-bottom: 0px;">

						<p:panelGrid columns="2" layout="grid"
							styleClass="panelgrid-noborder disabled disabled"
							columnClasses="ui-grid-col-7, ui-grid-col-5">

							<p:outputLabel style="font-weight: bold" value="Total a pagar: " />
							<p:outputLabel value="#{registroComprasBean.compra.valorTotal}" id="valorPagar"
								style="font-weight: bold;font-size: 22px;float: right;margin-top: -7px;">
								<f:convertNumber type="currency" />
							</p:outputLabel>

							<p:outputLabel
								style="font-weight: bold;margin-top: 6px;float: left;"
								for="formaPagamento" value="Tipo de pagamento: " />
							<p:selectOneMenu id="formaPagamento"
								value="#{registroComprasBean.tipoPagamento}" styleClass="tipo-pagamento"
								placeholder="selecione">

								<p:ajax event="change" onstart="start();" oncomplete="stop();"
									process="@this"
									listener="#{registroComprasBean.changeTipoPagamento}"
									update="entrada pagamento_para lbl-pagamento parcela-unica editar-parcelas gerar-parcelas primeira-parcela qtd-parcelas qtd-periodo panel-contas panel-confirm valorPagar" />

								<f:selectItems value="#{registroComprasBean.tiposPagamentos}"
									var="tipoPagamento" itemLabel="#{tipoPagamento.descricao}"
									itemValue="#{tipoPagamento}" />
							</p:selectOneMenu>
						</p:panelGrid>

						<p:panel id="panel-parcelas"
							styleClass="panelgrid-noborder disabled disabled panel-parcelas #{registroComprasBean.tipoPagamento == 'PARCELADO' ? '' : 'hide'}">

							<p:panelGrid columns="2" layout="grid"
								styleClass="panelgrid-noborder disabled disabled"
								columnClasses="ui-grid-col-7, ui-grid-col-5">
								
								<p:outputLabel value="" />
								<p:commandLink value="Editar entrada" onstart="start();"
									oncomplete="stop();" id="editar-parcelas"
									icon="fa fa-fw fa-edit"
									action="#{registroComprasBean.zerarParcelas}"
									update="@this entrada editar-parcelas 
										gerar-parcelas primeira-parcela 
										qtd-parcelas qtd-periodo btn-salvar"
									disabled="#{not registroComprasBean.parcelasConfirmadas}" />
																
								<p:outputLabel for="entrada"
									style="font-weight: bold;margin-top: 3px;float: left;"
									value="Entrada: " />

								<p:inputNumber id="entrada" decimalPlaces="2"
									placeholder="R$ 0,00" autocomplete="off" minValue="0"
									symbol="R$ " styleClass="entrada entrada_"
									value="#{registroComprasBean.valorEntrada}"
									disabled="#{registroComprasBean.parcelasConfirmadas}">
								</p:inputNumber>
					
								<p:outputLabel style="font-weight: bold;float: left;margin-top: 2px;" value="Primeira parcela: " /> 
								<p:commandLink id="primeira-parcela" value="#{registroComprasBean.primeiraParcelaEmString}" onstart="start();"
									oncomplete="PF('primeiraParc-dialog').show();stop();"
									actionListener="#{registroComprasBean.preparaPrimeiraParcela}"
									style="float: right;margin-top: 2px;"
									icon="fa fa-fw fa-edit"
									update="primeiraParc-dialog"
									disabled="#{registroComprasBean.parcelasConfirmadas}">
								</p:commandLink>
														
							</p:panelGrid>
														

							<p:panelGrid columns="2" layout="grid" id="panel-parcelamento" 
								styleClass="panelgrid-noborder disabled disabled"
								columnClasses="ui-grid-col-6, ui-grid-col-6">

								<p:outputLabel style="font-weight: bold;float: left;margin-top:10px;"
									value="Parcelamento: " />								
	
								<p:outputLabel />
								
								<p:inputNumber decimalPlaces="0" required="true" id="qtd-parcelas"
									requiredMessage="Quantidade de Parcelas deve ser informado."
									placeholder="Quantidade de Parcelas"
									value="#{registroComprasBean.parcelas}">
								</p:inputNumber>

								<p:selectOneMenu value="#{registroComprasBean.periodoPagamento}"
									id="qtd-periodo" placeholder="selecione">

									<f:selectItems
										value="#{registroComprasBean.periodosPagamentos}"
										var="periodoPagamento"
										itemLabel="#{periodoPagamento.descricao}"
										itemValue="#{periodoPagamento}" />
								</p:selectOneMenu>

							</p:panelGrid>



							<p:panel style="text-align: center;margin-top: 5px;margin-bottom: 5px;"
								styleClass="panelgrid-noborder disabled disabled">

								<p:commandButton value="Gerar parcelas" onstart="start();"
									oncomplete="stop();PF('parcelamento-dialog').show();"
									action="#{registroComprasBean.gerarParcelas}" id="gerar-parcelas"
									process="@this panel-parcelamento qtd-parcelas qtd-periodo entrada"
									update="msg btn-salvar parcelamento-dialog" disabled="#{registroComprasBean.tipoPagamento != 'PARCELADO'}"
									style="width: 110px; font-weight:bold"></p:commandButton>
							</p:panel>

							
						</p:panel>
	
						
						
						<p:panelGrid columns="2" layout="grid" id="pagamento_para" 
							styleClass="panelgrid-noborder disabled disabled parcela-unica hide"
							rendered="#{registroComprasBean.tipoPagamento == 'AVISTA'}"
							columnClasses="ui-grid-col-7, ui-grid-col-5">
							
							<p:outputLabel id="lbl-pagamento" style="font-weight: bold;float: left;margin-top: 4px;" value="Pagamento para: " /> 
							<p:commandLink id="parcela-unica" value="#{registroComprasBean.pagamentoParaEmString}" onstart="start();"
								oncomplete="PF('pagamentoPara-dialog').show();stop();"
								style="float: right;margin-top: 4px;"
								icon="fa fa-fw fa-edit" actionListener="#{registroComprasBean.preparaPagamentoPara}"
								update="pagamentoPara-dialog form-pagamentoPara:inline">
							</p:commandLink>
						</p:panelGrid>
						
						
						<p:panel id="panel-contas"
							styleClass="panelgrid-noborder disabled disabled panel-confirm">

							<p:outputLabel id="label-cp"
								style="font-weight: bold;margin-top: 7px;float: left;margin-left:1px;"
								value="Conta à pagar: "
								rendered="#{registroComprasBean.tipoPagamento == 'PARCELADO'}" />

							<p:inputSwitch onLabel="Sim" offLabel="Não" id="input-cp"
								style="float:right;width: 50px !important;margin-right: 2px;margin-top: 4px;"
								value="#{registroComprasBean.contaAPagar}"
								disabled="#{registroComprasBean.tipoPagamento == 'PARCELADO'}"
								rendered="#{registroComprasBean.tipoPagamento == 'PARCELADO'}">

								<p:ajax event="change" process="@this" update="@this" />
							</p:inputSwitch>

							<p:outputLabel id="label-av"
								style="font-weight: bold;margin-top: 7px;float: left;margin-left:1px;"
								value="PAGO: "
								rendered="#{registroComprasBean.tipoPagamento == 'AVISTA'}" />

							<p:inputSwitch onLabel="Sim" offLabel="Não" id="input-av" styleClass="pag-avista"
								style="float:right;width: 50px !important;margin-right: 2px;margin-top: 4px;"
								value="#{registroComprasBean.compraPaga}"
								rendered="#{registroComprasBean.tipoPagamento == 'AVISTA'}">

								<p:ajax event="change" process="@this" update="@this pagamento_para" listener="#{registroComprasBean.changeStatusPago}" onstart="PF('downloadLoading').show();" oncomplete="PF('downloadLoading').hide();" />
							</p:inputSwitch>		

						</p:panel>
						

						<div
							style="float: left; width: 80%; margin-left: 10%; margin-top: 15px; margin-bottom: 10px; border-top: 1px solid #ccc"></div>

						<p:panel style="text-align: right; margin-top: 13px;"
							id="panel-confirm"
							styleClass="panelgrid-noborder disabled disabled panel-confirm">

							<p:commandButton onstart="PF('downloadLoading').show();"
								oncomplete="PF('downloadLoading').hide();PF('confirmDialog').hide();"
								icon="fa fa-fw fa-close"
								style="width: 100px;margin-right:2px;background: #fd6161;"
								value="Cancelar"></p:commandButton>
							<p:commandButton process="@this form confirm-dialog"
								update="msg form" id="btn-salvar"
								onstart="start();" oncomplete="stop();"
								action="#{registroComprasBean.confirmarCompra}"
								icon="fa fa-fw fa-save"
								disabled="#{not registroComprasBean.parcelasConfirmadas and registroComprasBean.tipoPagamento == 'PARCELADO'}"
								style="width: 100px;background-color: #0d8819b5;font-weight:bold"
								value="Salvar"></p:commandButton>
						</p:panel>
					</p:panel>
				</div>

			</h:form>
		</p:dialog>
		
		
		
		
		
		<p:dialog header="Escanear Barcode" widgetVar="barcode-dialog"  position="top" style="margin-top: 100px"
			id="barcode-dialog" resizable="false" modal="true" width="350px" closable="false" 
			closeOnEscape="true" responsive="true">

			<h:form id="form-dialog2">

				<div class="ui-fluid" style="margin-top: 10px; text-align: center">
					
					<div id="scandit-barcode-picker" style="max-width: 350px; max-height: 100%;"></div>

					<div
						style="width: 80%; margin: auto; border-top: 1px solid #ccc; margin-top: 10px; margin-bottom: 10px"></div>

					<p:commandButton icon="fa fa-fw fa-close" styleClass="btn-close-dlgbarcode"
						style="margin-bottom: 5px;font-weight: bold;width: 100px;background:#e15e5ef0;float: right;"
						value="Fechar" update="barcode-dialog" 
						onstart="PF('downloadLoading').show();" 
						oncomplete="PF('downloadLoading').hide();PF('barcode-dialog').hide();">
					</p:commandButton>
				</div>
			</h:form>
		</p:dialog>
		
		
		
		<p:dialog id="parcelamento-dialog" showHeader="false" modal="true"
			widgetVar="parcelamento-dialog" draggable="false" width="300"
			closable="false" resizable="false" position="top"
			style="margin-top: 132px">

			<h:form id="form-parcelamento">
				
				<p:dataTable id="contasTable" paginatorAlwaysVisible="false"
					scrollable="true" scrollHeight="125" editable="true"
					editMode="cell" value="#{registroComprasBean.todasContas}"
					var="conta" emptyMessage="Nenhuma parcela gerada."
					paginator="false" styleClass="produtosTable"
					style="margin-top: 0px;border: 1px solid #147df0;">

					<p:column headerText="Parcela" width="15%"
						style="text-align: center">
						<h:outputText value="#{conta.parcela}" />
					</p:column>

					<p:column headerText="Valor" width="20%"
						style="text-align: center">

						<h:outputText value="#{conta.valor}">
							<f:convertNumber type="currency" />
						</h:outputText>
					</p:column>

					<p:column headerText="Vencimento" width="20%"
						style="text-align: center">

						<h:outputText value="#{conta.vencimento}">
							<f:convertDateTime pattern="dd/MM/yyyy" locale="pt" />
						</h:outputText>
					</p:column>

				</p:dataTable>

				<p:panel styleClass="panelgrid-noborder disabled disabled">
					<p:commandButton icon="fa fa-fw fa-check"
						style="float: right;font-weight: bold;font-size: 13px;background-color: #089a29c7;position: relative;margin-top: 8px;margin-right: 0px;"
						value="Confirmar" disabled="#{registroComprasBean.todasContasSize le 0}"
						process="@this parcelamento-dialog form-parcelamento"
						action="#{registroComprasBean.confirmarParcelas}" onstart="start();"
						update="confirm-dialog:entrada confirm-dialog:editar-parcelas 
						confirm-dialog:gerar-parcelas confirm-dialog:primeira-parcela 
						confirm-dialog:qtd-parcelas confirm-dialog:qtd-periodo 
						confirm-dialog:qtd-parcelas confirm-dialog:btn-salvar" oncomplete="stop();PF('parcelamento-dialog').hide();">
						
					</p:commandButton>

					<p:commandButton icon="fa fa-fw fa-close"
						style="float: right;font-weight: bold;margin-top: 8px;font-size: 13px;background-color: #ab3705b5;position: relative;margin-right: 3px;"
						value="Cancelar" onstart="start();"
						oncomplete="PF('parcelamento-dialog').hide();stop();">
					</p:commandButton>
				</p:panel>
			</h:form>
		</p:dialog>
		
		
		
		<p:dialog id="primeiraParc-dialog" showHeader="false" modal="true"
			widgetVar="primeiraParc-dialog" draggable="false" width="300"
			closable="false" resizable="false" position="top"
			style="margin-top: 132px">

			<h:form id="form-primeiraParc">
				<p:calendar id="inline" mode="inline"
					value="#{registroComprasBean.primeiraParcela}"
					locale="pt" pattern="dd/MM/yyyy" />

				<p:panel styleClass="panelgrid-noborder disabled disabled">
					<p:commandButton icon="fa fa-fw fa-check"
						style="float: right;font-weight: bold;font-size: 13px;background-color: #089a29c7;position: relative;margin-top: 8px;margin-right: 0px;"
						value="Confirmar"
						process="@this primeiraParc-dialog inline form-primeiraParc"
						action="#{registroComprasBean.confirmarPrimeiraParcela}" onstart="start();"
						update="confirm-dialog:entrada confirm-dialog:editar-parcelas 
							confirm-dialog:gerar-parcelas confirm-dialog:primeira-parcela 
							confirm-dialog:qtd-parcelas confirm-dialog:qtd-periodo" 
						oncomplete="stop();PF('primeiraParc-dialog').hide();">
					</p:commandButton>

					<p:commandButton icon="fa fa-fw fa-close"
						style="float: right;font-weight: bold;margin-top: 8px;font-size: 13px;background-color: #ab3705b5;position: relative;margin-right: 3px;"
						value="Cancelar" onstart="start();"
						oncomplete="PF('primeiraParc-dialog').hide();stop();">
					</p:commandButton>
				</p:panel>
			</h:form>
		</p:dialog>
		
		
		<p:dialog id="pagamentoPara-dialog" showHeader="false" modal="true"
			widgetVar="pagamentoPara-dialog" draggable="false" width="300"
			closable="false" resizable="false" position="top"
			style="margin-top: 132px">

			<h:form id="form-pagamentoPara">
				<p:calendar id="inline" mode="inline"
					value="#{registroComprasBean.pagamentoPara}"
					locale="pt" pattern="dd/MM/yyyy" />

				<p:panel styleClass="panelgrid-noborder disabled disabled">
					<p:commandButton icon="fa fa-fw fa-check"
						style="float: right;font-weight: bold;font-size: 13px;background-color: #089a29c7;position: relative;margin-top: 8px;margin-right: 0px;"
						value="Confirmar"
						process="@this pagamentoPara-dialog inline form-pagamentoPara"
						action="#{registroComprasBean.confirmarPagamentoPara}" onstart="start();"
						update="confirm-dialog:parcela-unica" 
						oncomplete="stop();PF('pagamentoPara-dialog').hide();">
					</p:commandButton>

					<p:commandButton icon="fa fa-fw fa-close"
						style="float: right;font-weight: bold;margin-top: 8px;font-size: 13px;background-color: #ab3705b5;position: relative;margin-right: 3px;"
						value="Cancelar" onstart="start();"
						oncomplete="PF('pagamentoPara-dialog').hide();stop();">
					</p:commandButton>
				</p:panel>
			</h:form>
		</p:dialog>
		

		<p:dialog id="downloadLoading" showHeader="false" modal="true"
			widgetVar="downloadLoading" header="Status" draggable="false"
			closable="false" resizable="false">
			<p:graphicImage name="images/loadingbar.gif"
				library="manhattan-layout" width="50" />
		</p:dialog>

		<script type="text/javascript">
			function start() {
				PF('downloadLoading').show();
			}

			function stop() {
				PF('downloadLoading').hide();
			}

			function ocultar() {
				delay(function() { 
						$(".panel-parcelas").addClass("hide");
					}, 500);
			}

			function mostrar() {
				$(".panel-parcelas").removeClass("hide");
			}
			
			
			function ocultarValores() {
				$(".grid-valores").addClass("hide");
				$(".parcela-unica").removeClass("hide");
				
			}

			function mostrarValores() {
				$(".grid-valores").removeClass("hide");
				$(".parcela-unica").addClass("hide");
			}
			
			
			function mostrarParcelaUnica() {
				$(".parcela-unica").removeClass("hide");			
			}
			
			function ocultarParcelaUnica() {
				$(".parcela-unica").addClass("hide");			
			}
			
			var delay = (function() {
			    var timer = 0;
			    return function(callback, ms) {
			        clearTimeout (timer);
			        timer = setTimeout(callback, ms);
			    };
			})();
			
			function ajaxDelayQtd(){
				var quantidade = $('.quantidade input').val(); 
				ajaxDelay(quantidade);
			}
			
			function ajaxDelayQtd_(){
				var quantidade = $('.quantidade_ input').val(); 
				ajaxDelay(quantidade);
			}
			
			function ajaxDelayQtd__(){
				var quantidade = $('.quantidade__ input').val(); 
				ajaxDelay(quantidade);
			}
			
			function ajaxDelay(quantidade_){ 
				var valorUnitario = $('.valor-unitario input').val();
				var quantidade = quantidade_;  
				var subtotal = parseFloat(valorUnitario.replace('R$ ','').replace('.','').replace(',','.')) * parseFloat(quantidade.replace('.','').replace(',','.'));
				
				if(subtotal.toString() != 'NaN') { 
					var f = parseFloat(subtotal).toLocaleString('pt-br',{style: 'currency', currency: 'BRL'});
					$('.sub-total input').val(f);
				}
				    
				delay(function() { 
					sendAjaxical(); 
					}, 500);
			}
			
			
			
			var licence = "Af7Ptlf9SIEnN6dNSi1RVVQVFERGB4bFyHv6PQ9SgWC+d5olnScMsiR0N6+iCdMmRlNmxYJy+ntHFDg3tkDVtI4tEgWASnfWGW2QR85FFM9AC1B86zjr8SQjlP1xQow/oBsWwNnWi+EZJRw7MfpRDZURUQUaLxK7QPzDO08xWnw6+EpNO3BxJQdp32uuxiZZk1Ob3Arc6yAQhToP3ktq4Gebf0dWNUAkwk0uPr/cHGaEdzVzxrOaAURS5zkkYkABE4lWGgzucTYWLr2sRfXaSoWKwDysGnzgM+JJXZvZrSylhQ618i/RY5UVvSlfat06he7vTD0XLBdkcI5rVGLLH4gLtPOIfRqkgV5K2EuJNgu1ggSx/jZ78xpU2BKlMlIgfw8ytWtVrgiKHPyz56dBOluFQlnQguQetkdCxAfmL+uv/XlJw1Dl2J+eCcDiKxTxLdzh4MuPm1txO/UVm5q8rm68rhcTRWXX0olZ7TBkMIpQDXZyzqRtS5kt+DdDDY+maNBHw1WiGIfuLS/XnOavB4xEhqK9imD41PSw10Fin/AdHGtqGUxEJHD6/ZEFP4Km5yZBBmn88DenuOuTNevGFvWP+0n8M2qAKhIbbdMRFx9kgj2cgM+BOyhvRC/GUm+HChTj6AB7uT9kVufqI2/20VVVoUSIpKfyaesf+YrXA2UXiFCBumLWRwPaYrsOi1E/XvA749twRAd+FJivXAu9mSf6YvO3HKx64IrN/KW3/8orDWcKdU10I5e3/Yk/frSguReiZLMI3+W4T/dL1Z60E2+H21LgvRrw4adScVkH";
			
			var reading = false; 
			var scaning = false;
			function readBarcode() {
				
				scaning = true;

				ScanditSDK.configure(licence , {
				  engineLocation: "https://cdn.jsdelivr.net/npm/scandit-sdk@5.x/build/",
				})
				  .then(() => {
					 return test=  ScanditSDK.BarcodePicker.create(document.getElementById("scandit-barcode-picker"), {
					playSoundOnScan: true,
				  	vibrateOnScan: true,
				      // enable some common symbologies
				      scanSettings: new ScanditSDK.ScanSettings({ enabledSymbologies: ["ean8", "ean13", "upca", "upce", "code128", "code39", "code93", "itf"], codeDuplicateFilter: 1000 }),
				    });
				  })
				  .then((barcodePicker) => {
				    // barcodePicker is ready here, show a message every time a barcode is scanned
				    barcodePicker.on("scan", (scanResult) => {
				    	
				    	if(scaning) {
				    		scaning = false;
				    		
				    		if(!reading) {
					    	  reading = true;
					    	  					    	  
						      $('.field-barcode').val(scanResult.barcodes[0].data);
						      //swal({ type: 'success', title: 'Concluído!', text: scanResult.barcodes[0].data });
						      //alert(text:scanResult.barcodes[0].data);
						      
						      codigoEscaneado(scanResult.barcodes[0].data);
						      						  
				    		}
				    	}
				    	
				    });
				    				    	
				    //barcodePicker.stopScanning();
				});
			}
		</script>

	</ui:define>

</ui:composition>
