<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml">

	<ui:define name="title">Total de Lançamentos</ui:define>

	<ui:define name="head">

		<script type="text/javascript">
			function percentExtender() {
				var tickColor = "#666";
				var gridlineColor = "rgba(0,0,0,0.1)";

				this.cfg.config.type = 'pie';

				this.cfg.config.options = {
					legend : {
						display : true,
					},

					title : {
						display : false,
						text : 'Top 5 Despesas - Mês atual'
					},
					tooltips : {
						callbacks : {

							label : function(tooltipItem, data) {
								var amount = data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];

								var total = eval(data.datasets[tooltipItem.datasetIndex].data
										.join("+"));

								var label = tooltipItem.yLabel;

								return numberToReal(amount)
										+ ' / '
										+ numberToReal(total)
										+ ' ( '
										+ parseFloat(amount * 100 / total)
												.toFixed(2) + '% )';
							}
						}
					},
				};
			}

			function percentExtender2() {
				var tickColor = "#666";
				var gridlineColor = "rgba(0,0,0,0.1)";

				this.cfg.config.options = {
					legend : {
						display : true,
					},

					tooltips : {
						callbacks : {

							label : function(tooltipItem, data) {
								var amount = data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];

								return numberToReal(amount);
							}
						}
					},
				};
			}
			
			function percentExtender3() {

			      this.cfg.config.options = {
			    		  legend: {
			    	            display: true,
			    	        },
			    	        
			          title: {
	  			         display: true,
	  			         text: 'Despesas vs Quantidade'
	  				},
	  				tooltips: {
	  			         callbacks: {

	  			             label: function (tooltipItem, data) {
	  			            	var amount = data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];
	                            
	                            var total = eval(data.datasets[tooltipItem.datasetIndex].data.join("+"));
	                            
	                            var label = tooltipItem.yLabel;
	                            
	                            return "QTY: " + amount + ' / ' + total + ' ( ' + parseFloat(amount * 100 / total).toFixed(2) + '% )';
	                        }
	  			          }
	  			       },
			       };
			}
			
			function percentExtender4() {
				var tickColor = "#666";
				var gridlineColor = "rgba(0,0,0,0.1)";

				this.cfg.config.options = {
					legend : {
						display : true,
					},

					tooltips : {
						callbacks : {

							label : function(tooltipItem, data) {
								var amount = data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];

								return numberToReal(amount);
							}
						}
					},
				};
			}

			function numberToReal(numero) {
				var numero = numero.toFixed(2).split('.');
				numero[0] = "R$ " + numero[0].split(/(?=(?:...)*$)/).join('.');
				return numero.join(',');
			}
		</script>

		<style>
@media ( min-width :220px) {
	.ui-fluid .ui-calendar, .ui-fluid .ui-calendar input {
		width: 100%;
	}
	body .ui-fluid .ui-trigger-calendar .ui-datepicker-trigger.ui-button {
		right: 0;
		height: 32px;
		top: -2px;
	}
	.dateStop {
		margin-left: 0px;
	}
	.barChart-01 {
		width: 100%;
		height: 150px;
		margin-top: 17px
	}
	.barChart-02 {
		width: 100%;
		height: 150px;
		margin-top: 17px;
	}
	.barChart-02 {
		width: 100%;
		height: 150px;
		margin-top: 15px;
	}
	.ano {
		width: 100%;
	}
	.btn-pie {
		margin-top:5px;
	}
}

@media ( min-width :460px) {
	.ui-fluid .ui-calendar, .ui-fluid .ui-calendar input {
		width: 90px;
	}
	body .ui-fluid .ui-trigger-calendar .ui-datepicker-trigger.ui-button {
		right: 113px;
		height: 32px;
		top: -2px;
	}
	.dateStop {
		margin-left: 20px;
	}
	.categoria {
		width: 84%;
	}
	.barChart-01 {
		width: 100%;
		height: 270px;
		margin-top: 47px;
	}
	.barChart-02 {
		width: 100%;
		height: 270px;
		margin-top: 10px;
	}
	.ano {
		width: 78% !important;
	}
	.btn-pie {
		margin-top:40px;
	}
}
</style>
	</ui:define>

	<ui:define name="content">

		<div class="page-header">
			<h1>Total de Lançamentos</h1>
		</div>

		<h:form id="form">

			<p:panelGrid columns="2" layout="grid"
				styleClass="panelgrid-noborder disabled disabled"
				columnClasses="ui-grid-col-6, ui-grid-col-6">

				<p:panel class="ui-lg-6 ui-fluid itens-add"
					style="padding-bottom: 0px !important; margin-top:10px;width:100%">

					<h3 style="font-weight: bold; margin-top: -8px;">Lançamentos por
						Dia</h3>

					<p:panelGrid columns="4" id="painel" layout="grid"
						styleClass="panelgrid-noborder disabled disabled"
						columnClasses="ui-grid-col-3, ui-grid-col-4, ui-grid-col-1">

						<p:outputLabel value="Data de início" for="data01" />
						<p:datePicker id="data01" value="#{relatorioLancamentosBean.dateStart}" readonlyInput="true"
							pattern="dd/MM/yyyy" locale="pt" showIcon="true">

							<p:ajax event="dateSelect"
								listener="#{relatorioLancamentosBean.createMixedModelPorDia}"
								process="@this" update="barChart-despesasPorDia" />
						</p:datePicker>


						<p:outputLabel value="até" id="data02" />
						<p:datePicker id="data-02" value="#{relatorioLancamentosBean.dateStop}" readonlyInput="true"
							styleClass="dateStop" pattern="dd/MM/yyyy" locale="pt"
							showIcon="true">

							<p:ajax event="dateSelect"
								listener="#{relatorioLancamentosBean.createMixedModelPorDia}"
								process="@this" update="barChart-despesasPorDia" />
						</p:datePicker>


						<p:outputLabel value="Categoria" for="categoria1" />
						<p:selectOneMenu id="categoria1" styleClass="categoria"
							value="#{relatorioLancamentosBean.categoriaPorDia}">
							<f:selectItem itemLabel="Selecione" itemValue="" />

							<p:ajax event="change"
								listener="#{relatorioLancamentosBean.changeCategoriaPorDia}"
								process="@this painel" update="barChart-despesasPorDia" />
							<f:selectItems
								value="#{relatorioLancamentosBean.todasCategoriasLancamento}"
								var="categoria" itemLabel="#{categoria.nome}"
								itemValue="#{categoria}"></f:selectItems>
						</p:selectOneMenu>
					</p:panelGrid>

					<p:commandButton icon="fa fa-pie-chart" actionListener="#{relatorioLancamentosBean.prepareDonutModelPorDia}" styleClass="btn-pie"
						title="Despesas por Quantidade" oncomplete="PF('produtos-qty').show();" update="form-dialog:pieChart-despesasPorQuantidade"
						style="color:#6a6565;background-color:#f2f2f200;border: 1px solid #a8a8a8;float: right; width: 35px;margin-right:10px" />
					
					<p:barChart id="barChart-despesasPorDia"
						model="#{relatorioLancamentosBean.mixedModelPorDia}"
						styleClass="barChart-01" />
				</p:panel>

				<p:panel class="ui-lg-6  ui-fluid itens-add"
					style="padding-bottom: 0px !important; margin-top:10px;width:100%">

					<h3 style="font-weight: bold; margin-top: -8px;">Lançamentos por
						Semana</h3>

					<p:panelGrid columns="2" layout="grid"
						styleClass="panelgrid-noborder disabled disabled"
						columnClasses="ui-grid-col-3, ui-grid-col-5">

						<p:outputLabel value="Ano" for="ano" />
						<p:selectOneMenu id="ano" styleClass="ano"
							value="#{relatorioLancamentosBean.ano01}">

							<p:ajax event="change"
								listener="#{relatorioLancamentosBean.createMixedModelPorSemana}"
								process="@this" update="barChart-despesasPorSemana" />
							<f:selectItems value="#{relatorioLancamentosBean.anos}" var="ano"
								itemLabel="#{ano}" itemValue="#{ano}"></f:selectItems>
						</p:selectOneMenu>

					</p:panelGrid>
					
					<p:panelGrid columns="4" id="painel2" layout="grid"
						styleClass="panelgrid-noborder disabled disabled"
						columnClasses="ui-grid-col-3, ui-grid-col-4, ui-grid-col-1, ui-grid-col-4">

						<p:outputLabel value="Nª Semana" for="num-semana1" />
						<p:selectOneMenu id="num-semana1" style="width: 100%"
							value="#{relatorioLancamentosBean.semana01}">

							<p:ajax event="change"
								listener="#{relatorioLancamentosBean.createMixedModelPorSemana}"
								process="@this" update="barChart-despesasPorSemana" />
							<f:selectItems value="#{relatorioLancamentosBean.semanas}"
								var="semana" itemLabel="#{semana}" itemValue="#{semana}"></f:selectItems>
						</p:selectOneMenu>

						<p:outputLabel value="Até" for="num-semana2" />
						<p:selectOneMenu id="num-semana2" style="width: 100%"
							value="#{relatorioLancamentosBean.semana02}">

							<p:ajax event="change"
								listener="#{relatorioLancamentosBean.createMixedModelPorSemana}"
								process="@this" update="barChart-despesasPorSemana" />
							<f:selectItems value="#{relatorioLancamentosBean.semanas}"
								var="semana" itemLabel="#{semana}" itemValue="#{semana}"></f:selectItems>
						</p:selectOneMenu>


						<p:outputLabel value="Categoria" for="categoria2" />
						<p:selectOneMenu id="categoria2" style="width: 100%"
							value="#{relatorioLancamentosBean.categoriaPorSemana}">

							<f:selectItem itemLabel="Selecione" itemValue="" />

							<p:ajax event="change"
								listener="#{relatorioLancamentosBean.changeCategoriaPorSemana}"
								process="@this"
								update="barChart-despesasPorSemana" />
							<f:selectItems
								value="#{relatorioLancamentosBean.todasCategoriasLancamento}"
								var="categoria" itemLabel="#{categoria.nome}"
								itemValue="#{categoria}"></f:selectItems>
						</p:selectOneMenu>
					</p:panelGrid>
					
					<p:commandButton icon="fa fa-pie-chart" actionListener="#{relatorioLancamentosBean.prepareDonutModelPorSemana}"
						title="Despesas por Quantidade" oncomplete="PF('produtos-qty').show();" update="form-dialog:pieChart-despesasPorQuantidade"
						style="color:#6a6565;background-color:#f2f2f200;border: 1px solid #a8a8a8;float: right; width: 35px;margin-top:5px;margin-right:10px" />
										
					<p:barChart id="barChart-despesasPorSemana" 
						model="#{relatorioLancamentosBean.mixedModelPorSemana}"
						styleClass="barChart-02" />
				</p:panel>

			</p:panelGrid>
			
			
			
			
			<p:panelGrid columns="2" layout="grid" style="margin-top:20px;margin-bottom:20px"
				styleClass="panelgrid-noborder disabled disabled"
				columnClasses="ui-grid-col-6, ui-grid-col-6">

				<p:panel class="ui-lg-6 ui-fluid itens-add"
					style="padding-bottom: 0px !important; margin-top:10px;width:100%">

					<h3 style="font-weight: bold; margin-top: -8px;">Lançamentos por
						Mês</h3>

					<p:panelGrid columns="2" layout="grid"
						styleClass="panelgrid-noborder disabled disabled"
						columnClasses="ui-grid-col-3, ui-grid-col-5">

						<p:outputLabel value="Ano" for="ano2" />
						<p:selectOneMenu id="ano2" styleClass="ano"
							value="#{relatorioLancamentosBean.ano02}">

							<p:ajax event="change"
								listener="#{relatorioLancamentosBean.createMixedModelPorMes}"
								process="@this" update="barChart-despesasPorMes" />
							<f:selectItems value="#{relatorioLancamentosBean.anos}" var="ano"
								itemLabel="#{ano}" itemValue="#{ano}"></f:selectItems>
						</p:selectOneMenu>

					</p:panelGrid>
					
					<p:panelGrid columns="4" layout="grid"
						styleClass="panelgrid-noborder disabled disabled"
						columnClasses="ui-grid-col-3, ui-grid-col-4, ui-grid-col-1,ui-grid-col-4">

						<p:outputLabel value="Nº Mês" for="mes1" />
						<p:selectOneMenu id="mes1" style="width: 100%"
							value="#{relatorioLancamentosBean.mes01}">

							<p:ajax event="change"
								listener="#{relatorioLancamentosBean.createMixedModelPorMes}"
								process="@this" update="barChart-despesasPorMes" />
							<f:selectItems value="#{relatorioLancamentosBean.meses}" var="mes"
								itemLabel="#{mes}" itemValue="#{mes}"></f:selectItems>
						</p:selectOneMenu>


						<p:outputLabel value="até" for="mes2" />
						<p:selectOneMenu id="mes2" style="width: 100%"
							value="#{relatorioLancamentosBean.mes02}">

							<p:ajax event="change"
								listener="#{relatorioLancamentosBean.createMixedModelPorMes}"
								process="@this" update="barChart-despesasPorMes" />
							<f:selectItems value="#{relatorioLancamentosBean.meses}" var="mes"
								itemLabel="#{mes}" itemValue="#{mes}"></f:selectItems>
						</p:selectOneMenu>


						<p:outputLabel value="Categoria" for="categoria3" />
						<p:selectOneMenu id="categoria3" style="width: 100%"
							value="#{relatorioLancamentosBean.categoriaPorMes}">

							<f:selectItem itemLabel="Selecione" itemValue="" />

							<p:ajax event="change"
								listener="#{relatorioLancamentosBean.changeCategoriaPorMes}"
								process="@this"
								update="barChart-despesasPorMes" />
							<f:selectItems
								value="#{relatorioLancamentosBean.todasCategoriasLancamento}"
								var="categoria" itemLabel="#{categoria.nome}"
								itemValue="#{categoria}"></f:selectItems>
						</p:selectOneMenu>
					</p:panelGrid>
			

					<p:commandButton icon="fa fa-pie-chart" actionListener="#{relatorioLancamentosBean.prepareDonutModelPorMes}"
						title="Despesas por Quantidade" oncomplete="PF('produtos-qty').show();" update="form-dialog:pieChart-despesasPorQuantidade"
						style="color:#6a6565;background-color:#f2f2f200;border: 1px solid #a8a8a8;float: right; width: 35px;margin-top:5px;margin-right:10px" />
				
					<p:barChart model="#{relatorioLancamentosBean.mixedModelPorMes}"
						id="barChart-despesasPorMes" styleClass="barChart-02" />
				</p:panel>

				<p:panel class="ui-lg-6  ui-fluid itens-add"
					style="padding-bottom: 0px !important; margin-top:10px;width:100%">

					<h3 style="font-weight: bold; margin-top: -8px;">Lançamentos por
						Ano</h3>
					
					<p:panelGrid columns="4" id="painel3" layout="grid"
						styleClass="panelgrid-noborder disabled disabled"
						columnClasses="ui-grid-col-3, ui-grid-col-4, ui-grid-col-1, ui-grid-col-4">

						<p:outputLabel value="Ano" for="ano3" />
						<p:selectOneMenu id="ano3" style="width: 100%"
							value="#{relatorioLancamentosBean.ano03}">
							
							<p:ajax event="change"
								listener="#{relatorioLancamentosBean.createMixedModelPorAno}"
								process="@this" update="barChart-despesasPorAno" />
							<f:selectItems value="#{relatorioLancamentosBean.anos}" var="ano"
								itemLabel="#{ano}" itemValue="#{ano}"></f:selectItems>
						</p:selectOneMenu>

						<p:outputLabel value="Até" for="ano4" />
						<p:selectOneMenu id="ano4" style="width: 100%"
							value="#{relatorioLancamentosBean.ano04}">
							
							<p:ajax event="change"
								listener="#{relatorioLancamentosBean.createMixedModelPorAno}"
								process="@this" update="barChart-despesasPorAno" />
							<f:selectItems value="#{relatorioLancamentosBean.anos}" var="ano"
								itemLabel="#{ano}" itemValue="#{ano}"></f:selectItems>
						</p:selectOneMenu>


						<p:outputLabel value="Categoria" for="categoria4" />
						<p:selectOneMenu id="categoria4" style="width: 100%"
							value="#{relatorioLancamentosBean.categoriaPorAno}">
							
							<f:selectItem itemLabel="Selecione" itemValue="" />
							
							<p:ajax event="change"
								listener="#{relatorioLancamentosBean.changeCategoriaPorAno}"
								process="@this" update="barChart-despesasPorAno" />
							<f:selectItems value="#{relatorioLancamentosBean.todasCategoriasLancamento}"
								var="categoria"
								itemLabel="#{categoria.nome}"
								itemValue="#{categoria}"></f:selectItems>
						</p:selectOneMenu>
					</p:panelGrid>

					<p:commandButton icon="fa fa-pie-chart" actionListener="#{relatorioLancamentosBean.prepareDonutModelPorAno}" styleClass="btn-pie"
						title="Despesas por Quantidade" oncomplete="PF('produtos-qty').show();" update="form-dialog:pieChart-despesasPorQuantidade"
						style="color:#6a6565;background-color:#f2f2f200;border: 1px solid #a8a8a8;float: right; width: 35px;margin-right:10px" />
				
					<p:barChart id="barChart-despesasPorAno" model="#{relatorioLancamentosBean.mixedModelPorAno}"
						styleClass="barChart-01" />
						
				</p:panel>

			</p:panelGrid>

		</h:form>
		
		<p:dialog
			header="Despesas por Quantidade"
			widgetVar="produtos-qty" id="produtos-qty" resizable="false"
			modal="true" closeOnEscape="true" responsive="true" position="center"
			styleClass="modal-donut" width="250px">

			<h:form id="form-dialog">

				<div class="ui-fluid">

					<div class="card card-w-title ui-fluid"
						style="padding: 0px 5px 0px 5px; padding-bottom: 0px !important;margin-bottom: 10px;text-align: center;">

						<p:donutChart id="pieChart-despesasPorQuantidade" 
						model="#{relatorioLancamentosBean.donutModel}" style="width: 100%; height: 320px;margin-top:10px" />
						
						
						<p:commandButton icon="fa fa-fw fa-close" style="margin-top: 5px;font-weight: bold;width: 120px;background: #f3f3f3f0;color: #716c6c;border: 1px solid #484545;"
							value="Fechar" 
							oncomplete="PF('produtos-qty').hide();">
						</p:commandButton>

					</div>
				</div>
			</h:form>
		</p:dialog>

		
	</ui:define>

</ui:composition>