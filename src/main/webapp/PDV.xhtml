<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml">

	<ui:define name="title">PDV</ui:define>

	<f:metadata>
		<f:viewAction action="#{pDVBean.inicializar}" />

		<f:viewParam name="id" value="#{pDVBean.venda.id}" />
		<f:viewAction action="#{pDVBean.buscar}"
			if="#{param.id ne null}" />
	</f:metadata>

	<ui:define name="content">
	
		<script src="https://cdn.jsdelivr.net/npm/scandit-sdk@5.x"></script>

		<style>
@media ( min-width :220px) {
	.desconto .ui-state-disabled {
    	opacity: 1;
    }
	.tipo-pagamento.ui-state-disabled {
    	opacity: .75;
    }
    .pag-avista.ui-state-disabled {
    	opacity: .75;
    }
	body.swal2-toast-shown .swal2-container.swal2-top-end, body.swal2-toast-shown .swal2-container.swal2-top-right {
	    bottom: 0 !important;
	    left: 0 !important;
	    background: rgba(0,0,0,.4) !important;
	    margin-top: 65px;
	}
	#primeiraParc-dialog.ui-dialog .ui-dialog-content {
	    padding: 8px 19px;
	}
	
	#pagamentoPara-dialog.ui-dialog .ui-dialog-content {
	    padding: 8px 19px;
	}
	
	.sub_total .ui-panel-content {
		margin-top: 10px !important;
		margin-bottom: 4px;
	}
	#confirmDialog .ui-panel .ui-panel-content {
	    padding: 6px 0px;
	}
	#confirmDialog.ui-dialog {
	    width: 350px !important;
	}
    #confirmDialog .forma-pagamento.ui-selectonemenu {
	    width: 100% !important;
	    min-width: 100% !important;
	}
	#confirmDialog .forma-pagamento.ui-selectonemenu .ui-selectonemenu-label {
	    white-space: normal;
	}
	.entrada_ > .ui-inputtext {
	    color: #53ab5c;
	    font-weight: bold;
    }
    .valor-recebido > .ui-inputtext {
	    color: #53ab5c;
	    font-weight: bold;
    }
    .troco > .ui-inputtext {
	    color: #147df0;
	    font-weight: bold;
    } 
    
    .falta > .ui-inputtext {
	    color: #ea3911;
	    font-weight: bold;
    } 
    
	#confirmDialog .ui-panelgrid .ui-panelgrid-cell:nth-child(2n) {
		text-align: end;
	}
	#confirmDialog .ui-datatable .ui-datatable-data>tr td.ui-editable-column input
		{
		text-align: right;
	}
	#confirmDialog .ui-panelgrid .ui-panelgrid-cell {
		padding: 2px 2px;
	}
	#confirmDialog.ui-dialog .ui-dialog-content {
		padding: 0px 12px 0px 12px !important;
	}
	#confirmDialog .ui-grid-responsive .ui-grid-row {
		display: flex;
	}
	.panel-confirm.ui-panel .ui-panel-content {
		padding: 0px !important;
	}
	.panel-parcelas.hide {
		max-height: 0;
		pointer-events: none;
		transition: max-height 0.3s ease-in-out;
		
	}
	.panel-parcelas {
		overflow: hidden;
		max-height: 300px;
		transition: max-height 1s ease-in-out;
	}
	.panel-parcelas.ui-panel .ui-panel-content {
		padding: 2px 0px 2px 0px !important;
	}
	
	.grid-valores.hide {
		max-height: 0;
		pointer-events: none;
		transition: max-height 0.3s ease-in-out;
	}
	.grid-valores {
		overflow: hidden;
		max-height: 300px;
		transition: max-height 1s ease-in-out;		
	}
	
	.parcela-unica.hide {
		max-height: 0;
		pointer-events: none;
		transition: max-height 0.3s ease-in-out;
		margin-bottom: 0px;
		margin-top: 0px;
	}
	.parcela-unica {
		overflow: hidden;
		max-height: 300px;
		transition: max-height 1s ease-in-out;	
		margin-bottom: 5px;	
		
	}
	
	.panel-info-entrega {
		margin-top: -10px;
	}
	body .ui-fieldset .ui-fieldset-content {
	    padding: 6px 7px;
	}
	.ui-fieldset .ui-panelgrid .ui-grid-responsive .ui-panelgrid-cell {
	    padding: 4px 4px !important;
	}
	.ui-fieldset .ui-panelgrid-cell:nth-child(2) {
	    padding: 0px 11px !important;
	}
	.panel-busca-leitor.ui-panelgrid .ui-panelgrid-cell {
		text-align: right !important;
	}
	.image-delivery {
		display:none;
	}
	body .ui-selectbooleanbutton.ui-state-active {
	    /*background-color: #f58244cc;*/
	}
	.panel-desc {
		margin-top:15px;
	}
 	.panel-desc .ui-grid-col-4:first-child {
 		text-align: center;
 	}
 	.panel-itens {
 		margin-bottom: 0px;margin-top: 0px; padding-bottom: 0% !important;
 	}
	.panel-itenstable {
	    margin-top: 4px;
	    border: none;
	    margin-top: -30px;
	}
	.panel-totalpagar {
		float: right;
	}
	
	.btn-finalizar.ui-button {
		font-weight: bold;
	    margin-bottom: 0px;
	    background-color: #0d8819b5 !important;
	    width: 50%;
    	margin-right: 0px;   
	 }
	 
	 .btn-cancelar.ui-button {
		font-weight: bold;
	    margin-bottom: 0px;
	    background-color: #ce050ec9 !important;
	    width: 49%;
	 }
	 
	 body .ui-button.ui-button-text-icon-left .ui-icon {
	    margin-top: -8px;
	    font-size: 16px;
	}
	.panel-itenstable .ui-widget-content {
		border: none;
	}
	.panel-busca-leitor {
		display: block;
	}
	.busca .ui-autocomplete-input {
    	margin-top: 0px;
    }
	.ui-inputswitch {
   		width: 60px !important;
    }
    .ui-inputswitch .ui-inputswitch-handle {
    	width: 28px !important;
    }
    .ui-inputswitch .ui-inputswitch-off {
    	width: 32px !important;
    }
    
	.white-button.ui-state-disabled {
    	opacity: 0.9;
    }
	.ui-autocomplete-panel {
	    max-height: 200px !important;
	    overflow: auto;
	}
	.busca .ui-autocomplete-input {
		color: #868686 !important;
	}
	
	.busca-por-leitor.ui-inputfield {
	    color: #868686 !important;
	}
	
	.data-venda .ui-widget-content {
	    border: none;
	}
	
	.data-venda .ui-state-disabled {
    	opacity: 0.7;
    }
    
    .vendedor.ui-state-disabled {
    	opacity: 0.7;
    }
	
	.descricao .ui-panelgrid-cell:nth-child(2) {
	    padding-left: 0px !important;
	}
	
	.descricao .ui-panelgrid-cell:nth-child(1) {
    	padding-right: 4px 10px;
    }
	
	.white-button.ui-button.ui-state-default {
        background-color: #ffffff;
        color: #222222;
        border: 1px solid #b6b7c2;
    }
 
    .white-button.ui-button.ui-state-default:enabled:hover, 
    .white-button.ui-button.ui-state-default:focus {
        background-color: #f2f2f2;
        border: 1px solid #b6b7c2;
        color: #373a3c;
    }
	.valor-total .ui-widget-content {
		background-color: transparent;
	}
	body .ui-button.ui-button-text-icon-right .ui-button-text {
	    padding: 5px 5px 5px 8px;
	}
	.card h1:first-child {
		margin-top: 7px;
		margin-bottom: .82em;
	}
	body .ui-tabs.ui-tabs-top .ui-tabs-nav li a {
		padding: 0.57em 12px;
	}
	body .ui-tabs.ui-tabs-top {
		margin: 0px 3px 0px 1px;
	}
	.layout-wrapper .layout-main .layout-content {
		padding: 60px 0px 0px 0px;
	}
	.panel-left {
		border-right: none;
	}
	
	
	.panel-desc .ui-panelgrid-cell:nth-child(2) {
	    padding-left: 10px !important;
	}
	
	.quantidade .ui-inputfield {
    	border: 1px solid #f28a8b;
    }    
    .quantidade .ui-inputfield.ui-state-hover:not(.ui-state-error) {
    	border: 1px solid #f28a8b;
    }
    .quantidade .ui-inputfield.ui-state-focus:not(.ui-state-error) {
    	border: 1px solid #f28a8b;
    	box-shadow: 0 0 3px 0 #f28a8b;
    }
    
    .campos-valor {
    	width: 95%;
    	margin: auto;
    }
    
    .campos-percentual {
    	width: 100%;
    	margin: auto;
    }
    
     .campos-percentual .ui-panelgrid-cell:nth-child(1) {
		padding-left: 5px !important;
	}
	.campos-percentual .ui-panelgrid-cell:nth-child(2) {
		padding-left: 5px !important;
	}
	.campos-percentual .ui-panelgrid-cell:nth-child(3) {
		padding-left: 5px !important;
	}
	.campos-percentual .ui-panelgrid-cell:nth-child(1) {
		padding-right: 0px !important;
	}
	.campos-percentual .ui-panelgrid-cell:nth-child(2) {
		padding-right: 0px !important;
	}
	
	
	.campos-valor .ui-panelgrid-cell:nth-child(1) {
		padding-left: 1px !important;
	}
	.campos-valor .ui-panelgrid-cell:nth-child(2) {
		padding-left: 0px !important;
	}
	.campos-valor .ui-panelgrid-cell:nth-child(3) {
		padding-left: 0px !important;
	}
	.campos-valor .ui-panelgrid-cell:nth-child(1) {
		padding-right: 0px !important;
		margin-right:1px;
	}
	.campos-valor .ui-panelgrid-cell:nth-child(2) {
		padding-right: 0px !important;
		margin-right:1px;
	}
	.campos-valor .ui-panelgrid-cell:nth-child(3) {
		padding-right: 0px !important;
	}
	.subtotal .ui-panelgrid-cell {
		padding-right: 0px !important;
	}
	
	.ui-panelgrid .ui-grid-responsive .ui-panelgrid-cell {
		padding: 4px 10px;
	}
	
	body .ui-datatable thead th {
		font-size: 13px;
	}
	body .ui-panel .ui-panel-content {
		padding: 0;
	}
	.panel-right .ui-panel-content {
		margin-left: -3px;
	}
	.panel-right .ui-widget-content {
		border: none;
		background: transparent;
	}
	.panel-body.ui-panelgrid .ui-panelgrid-cell:nth-child(2) {
		padding: 4px 10px;
	}
	.ui-datatable tbody td {
		height: auto !important;
	}
	.btn-select.ui-button.ui-button-icon-only .ui-icon {
		margin-top: -8px;
		font-size: 18px;
		color: #0f5baf;
	}
	.produtosTable .btn-select.ui-button {
		height: 30px;
		width: 30px;
		background-color: transparent;
		border: 1px solid #0f5baf;
		border-radius: 50px;
	}
	.produtosTable .btn-select.ui-button:hover {
		background-color: #e0dada;
	}
	.ui-datatable-scrollable-body {
		overflow: auto;
		max-height: 395px;
	}
	.itens-add {
		margin-top: -15px;
	}
	body .ui-panel .ui-panel-content {
		border: none;
	}
	.ui-blockui-content {
		padding: 0.25em;
	}
	.ui-slider .ui-slider-handle {
		width: 1.7em;
		height: 1.7em;
	}
	.ui-slider-horizontal {
		height: 1.2em !important;
	}
	body .ui-fluid .ui-trigger-calendar .ui-datepicker-trigger.ui-button {
		height: 28px !important;
	}
	.result .apply-result .ui-grid-responsive .ui-grid-col-4 {
		width: 50% !important;
		float: left !important;
	}
	.result .apply-result .ui-grid-responsive .ui-grid-col-6 {
		width: 50% !important;
		float: left !important;
	}
	.qty-parcelas.ui-panelgrid .ui-panelgrid-cell:nth-child(1) {
		margin-top: 10px !important;
	}
	.percentual-juros.ui-panelgrid .ui-panelgrid-cell:nth-child(1) {
		margin-top: 8px !important;
	}
	.ui-datatable thead th, .ui-datatable tbody td, .ui-datatable tfoot td,
		.ui-datatable tfoot th {
		font-size: 13px;
	}
	body .btn-new.ui-button {
		color: #676363;
		background-color: #f9f9f9;
		border: 1px solid #8a8585;
	}
	.swal2-popup {
		width: 28em;
		max-width: 100%;
		padding: 0 0 0.4em 0;
		font-size: 0.75rem;
	}
	.swal2-popup #swal2-content {
		font-weight: 400;
	}
	body #item-dialog.ui-dialog .ui-dialog-content {
		background-color: #ffffff;
		padding: 10px 0px 0px 0px;
	}
	body .ui-datatable .ui-paginator {
		padding: 2px 0px !important;
	}
	.panel-entrega.ui-widget a {
		float: left !important;
		margin-top: 10px !important;
		margin-left: 80px;
		font-size: 13px;
	}
	.panel-entrega .ui-state-disabled {
		float: left !important;
		margin-top: -29px !important;
		margin-left: 80px;
		font-size: 13px;
	}
	#entrega-dialog .ui-panel .ui-panel-content {
		padding: 0px;
	}
	.panel-entrega {
		margin-top: 8px;
	}
	.panel-ajuste {
		margin-top: -10px;
	}
	.white-button.ui-button.ui-state-default {
    	display: none;
    	float: right;
    	margin-right:2px;
    }
    
    .white-button_.ui-button.ui-state-default {
    	display: block;
    	float: right;    	
    }
    .image-produto {
    	width: 60%;
    	height: auto;
    	margin-top: -47px;
    }
    .line-total {
		display:none;
	}
	.total-pagar {
		font-weight: bold;
	}
	.desconto {
		text-align: center;
		width: 97%;
	}
	
	.margem {
		text-align: center;
		width: 97%;
	}
	
	.panel-body {
		margin-bottom: 5px;
		/*margin-top:5px;
		padding:18px;*/
	}
	
	.desconto.ui-panel {
	    margin: 0px;
	}

	.panel-total-geral {
		padding-bottom: 0px;
		margin-top: 15px;
	    position: relative;
	    bottom: 0;
	    width: 100%;
	}
	
	.panel-total-geral .ui-panelgrid {
		width: 120%;
	}
	.ui-datatable-scrollable-body {
		overflow: auto;
		max-height: 280px;
	}
}

@media ( min-width :460px) {
	#confirmDialog .ui-panel .ui-panel-content {
	    padding: 1px 0px;
	}
	#confirmDialog.ui-dialog {
	    width: auto !important;
	}
	#confirmDialog .forma-pagamento.ui-selectonemenu {
   		width: 100% !important;
   		min-width: 100% !important;
    }
	.panel-total-geral {
		margin-top: 23px;
	}
	.sub_total {
		margin-top: 10px;
		margin-bottom: 10px;
	}
	.panel-body.ui-panelgrid .ui-panelgrid-cell:nth-child(2) {
	    padding: 10px 18px;
	}
	.panel-info-entrega {
		margin-top: 5px;
	}
	.ui-fieldset .ui-panelgrid-cell:nth-child(2) {
	    padding: 2px !important;
	}
	.panel-body.ui-panelgrid .ui-panelgrid-cell:nth-child(2) {
		padding: 2px 2px 0px 0px;
	}
	.panel-total-geral.card.card-w-title {
		padding: 2px;
	}
	.panel-desc {
		margin-top:10px;
	}
	.white-button_.ui-button.ui-state-default {
    	display: none !important;  	
    }
	.desconto.ui-panel {
		width: 100%;
	}
	.image-delivery {
		display:block;
	}
	.panel-itenstable {
	    margin-top: 0px;
	}
	.panel-itens {
 		padding-bottom: 40% !important;
 	}
	.panel-total-geral {
		padding-bottom: 0px;margin-bottom: 28px;position: absolute;bottom: 0;width: 400px;
	}
	.total-pagar {
		margin-top: -38px;float: left;margin-right: -82px;margin-bottom:5px;
	}
	.panel-body {
		padding:0px;
	}
	.panel-desc .ui-grid-col-4:first-child {
 		text-align: none;
 	}
	.desconto {
		text-align: center;width: 95%;margin: auto;
	}
	
	.margem {
		text-align: center;width: 95%;margin: auto;
	}
	.campos-valor {
    	width: 100%;
    }
    .campos-percentual .ui-panelgrid-cell:nth-child(1) {
		padding-left: 1px !important;
	}
	.campos-percentual .ui-panelgrid-cell:nth-child(2) {
		padding-left: 0px !important;
	}
	.campos-percentual .ui-panelgrid-cell:nth-child(3) {
		padding-left: 0px !important;
	}
	.campos-percentual .ui-panelgrid-cell:nth-child(1) {
		padding-right: 0px !important;
		margin-right:1px;
	}
	.campos-percentual .ui-panelgrid-cell:nth-child(2) {
		padding-right: 0px !important;
		margin-right:1px;
	}
	.campos-percentual .ui-panelgrid-cell:nth-child(3) {
		padding-right: 0px !important;
	}
	.line-total {
		width: 400px;
	    border-top: 1px solid #ccc;
	    z-index: 1;
	    display:block;
	}
	.panel-desc .ui-panelgrid-cell:nth-child(2) {
		padding-left: 15px !important;
	}
	.descricao .ui-panelgrid-cell:nth-child(1) {
	    padding-right: 0px !important;
	    margin-right: -2px !important;
	}
	.panel-itenstable {
	     margin-bottom: 0px;
	}
	.panel-finalizar {
		float:left;
		bottom:0;
		position:absolute;
	}
	
	.btn-finalizar.ui-button {
		font-weight: bold;
	    margin-bottom: 0px;
	    background-color: #0d8819b5;
	    width: 34% !important;
	    margin-left:2px;
	 }
	 .btn-cancelar.ui-button {
		font-weight: bold;
	    margin-bottom: 0px;
	    background-color: #ce050ec9 !important;
	   	width: 34% !important;
	 }
	.panel-finalizar .ui-widget-content {
	    background: transparent;
	}
	.panel-totalpagar {
		margin-right: 30px;
	    margin-bottom: 13px;
	    bottom: 0;
	    position: absolute;
	    z-index: 1;
	    right: 0;
	}
	.ui-panelgrid .ui-grid-responsive .ui-panelgrid-cell {
		padding: 2px;
	}
	.image-produto {
		width: 100%;
	    height: auto;
	    margin-top: 0px;
	}
	.busca .ui-autocomplete-input {
		margin-top: 0px;
	}
	.white-button.ui-button.ui-state-default {
    	display: block;
    }
	.panel-busca-leitor {
		display: block;
		margin-top: 5px;
	}
	.panel-left {
		border-right: 4px solid #21222d9e !important;
		min-height: 562px;
		padding: 0px;
	}
	.panel-entrega {
		margin-top: 0px;
	}
	.panel-ajuste {
		margin-top: 0px;
	}
	.panel-entrega .ui-state-disabled {
		float: left !important;
		margin-top: 10px !important;
		margin-left: 0px;
		font-size: 13px;
	}
	.ui-panelgrid .ui-widget a {
		float: left !important;
		margin-left: 0px;
		font-size: 13px;
	}
	.ui-slider .ui-slider-handle {
		width: 1.7em;
		height: 1.7em;
	}
	.ui-slider-horizontal {
		height: 1.2em;
	}
	body .ui-fluid .ui-trigger-calendar .ui-datepicker-trigger.ui-button {
		height: 27px !important;
	}
	.ui-datatable thead th, .ui-datatable tbody td, .ui-datatable tfoot td,
		.ui-datatable tfoot th {
		font-size: 14px;
	}
}

@media ( min-width :640px) {
	
	.ui-slider-handle {
		width: 1.2em !important;
		height: 1.2em !important;
	}
	.ui-slider-horizontal {
		height: 0.8em !important;
	}
	body .ui-fluid .ui-trigger-calendar .ui-datepicker-trigger.ui-button {
		height: 27px !important;
	}
	.result .apply-result .ui-grid-responsive .ui-grid-col-4 {
		width: 33.33333% !important;
		float: none;
	}
	.result .apply-result .ui-grid-responsive .ui-grid-col-6 {
		width: auto !important;
		float: none;
	}
	.itens-add {
		margin-top: 0px;
	}
	.ui-datatable tbody td {
		height: 28px !important;
	}
}

@media ( min-width :641px) {
	.ui-datatable-scrollable-body {
		overflow: auto;
		max-height: 365px;
	}
}
</style>

		<p:growl id="msg" closable="true" life="3000" showSummary="false"
			showDetail="true" style="text-align: center" />

		<div class="ui-g-12 ui-lg-12">

			<h:form id="form">
			
				<p:hotkey bind="ctrl+shift+f" action="#{pDVBean.finalizar}" 
					onstart="PF('downloadLoading').show();selectTab1();" oncomplete="PF('downloadLoading').hide();"
					update="msg confirm-dialog confirmDialog tabView:data-venda tabView:tipo-venda tabView:panel-entrega tabView:panel-ajuste tabView:vendedor tabView:bairro panel-table tabView:id tabView:codigo tabView:descricao tabView:fornecedor tabView:valor-unitario tabView:quantidade tabView:valor-total tabView:lote"
				 	process="@this panel-table tabView:data-venda tabView:vendedor tabView:bairro tabView:tipo-venda tabView:panel-ajuste" />
			
			
				<p:remoteCommand name="cancelaVenda" process="@this"
					update="form" action="#{pDVBean.novaVenda}"
					onstart="PF('downloadLoading').show();"
					oncomplete="PF('downloadLoading').hide();" />

				<p:defaultCommand target="btn-calcular" rendered="false" />

				<p:panelGrid columns="2" layout="grid" style="padding-bottom: 10%;backgound:#fff;"
					styleClass="panelgrid-noborder disabled disabled panel-body"
					columnClasses="ui-grid-col-6, ui-grid-col-6">

					<p:panel class="card card-w-title ui-fluid panel-left"
						id="panel-itens">

						<h1>#{pDVBean.venda.id == null ? 'Registrar Venda - PDV'
							: 'Informações da Venda'}</h1>

						<p:tabView id="tabView" effect="slide"
							activeIndex="#{pDVBean.activeIndex}">
						

							<p:tab title="Produto" titleStyleClass="tabs" id="tab-receita">
														
								<p:focus for="busca" rendered="#{(pDVBean.itemVenda.produto.id == null and not pDVBean.leitor) or pDVBean.itemVenda.produto.quantidadeAtual le 0}" />
								
								<p:focus for="busca-por-leitor" rendered="#{(pDVBean.itemVenda.produto.id == null and pDVBean.leitor) or pDVBean.itemVenda.produto.quantidadeAtual le 0}" />
								
								<p:focus id="focus-qtde" for="quantidade" rendered="#{pDVBean.itemVenda.produto.id != null and pDVBean.itemVenda.produto.quantidadeAtual ge 1}"  />

								<p:inputText id="id" type="hidden"
									value="#{pDVBean.itemVenda.code}" required="true"
									requiredMessage="Produto deve ser informado." /> 
									
								<p:inputText id="customedio" type="hidden" styleClass="valor-custo"
									value="#{pDVBean.itemVenda.produto.custoMedioUnitario}" />									
									
								<p:inputText id="preco-venda" type="hidden" styleClass="preco-venda"
									value="#{pDVBean.itemVenda.produto.precoDeVenda}" />
									
								<p:defaultCommand scope="campos-valor" target="btn-adicionar" 
									rendered="#{pDVBean.itemVenda.produto.id != null}" />
									
								<p:defaultCommand scope="panel-desconto" target="btn-adicionar" 
									rendered="#{pDVBean.itemVenda.produto.id != null}" />								
							

								<p:panelGrid columns="3" layout="grid" 
									styleClass="panelgrid-noborder disabled disabled panel-busca-leitor"
									columnClasses="ui-grid-col-6, ui-grid-col-3, ui-grid-col-3">

									<p:commandLink value="Pesquisa avançada" disabled="true"
										style="font-size: 14px;margin-top: 7px;float:left;">
										<i class="fa fa-fw fa-search"></i>
									</p:commandLink>

									<p:outputLabel value="Leitor de código de barras" for="leitor" />
									<p:selectBooleanButton id="leitor"
										value="#{pDVBean.leitor}" onLabel="ATIVADO"
										offLabel="DESATIVADO" onIcon="fa fa-fw fa-check"
										offIcon="fa fa-fw fa-close" style="font-size:11px;width:105px;float: right;">
										
										<p:ajax process="@this" listener="#{pDVBean.ativarLeitor}" update="tabView panel-busca" />										
									</p:selectBooleanButton>

								</p:panelGrid>

								<p:panelGrid id="panel-busca" columns="2" layout="grid" style="margin-top: 5px;"
									styleClass="panelgrid-noborder disabled disabled descricao"
									columnClasses="ui-grid-col-11, ui-grid-col-1">

									<p:autoComplete id="busca" value="#{pDVBean.produto}" 
										placeholder="Digite o código ou descrição do produto"
										var="produto" styleClass="busca" rendered="#{not pDVBean.leitor}"
										itemLabel="#{produto.codigo.concat(' | ').concat(produto.descricao)}" itemValue="#{produto}"
										completeMethod="#{pDVBean.completeText_Produto}">
										
										<p:ajax event="itemSelect" listener="#{pDVBean.onItemSelect}" 
											update="tabView" />
									</p:autoComplete>
									
									<p:inputText id="busca-por-leitor" value="#{pDVBean.filter.codigo}" styleClass="field-barcode busca-por-leitor"
										placeholder="Escaneie ou digite o código do produto" rendered="#{pDVBean.leitor}" />
										
									<p:commandButton id="btn-barcode" icon="fa fa-fw fa-barcode" 
										action="#{pDVBean.pesquisar}" process="@this busca-por-leitor"
										update="tabView" 
										style="width:38px;height:29px" styleClass="white-button btn-barcode" />
										
									<p:commandButton id="enter-barcode" icon="fa fa-fw fa-camera-retro" 
										onstart="readBarcode();"
										oncomplete="PF('barcode-dialog').show();"
										style="width:38px;height:29px" styleClass="white-button white-button_" />
								</p:panelGrid>


								<p:panelGrid id="panel-desc" columns="2" layout="grid" 
									styleClass="panelgrid-noborder disabled disabled panel-desc"
									columnClasses="ui-grid-col-4, ui-grid-col-8">

									<p:graphicImage library="myapp" name="images/scan-icon.jpg"  
										style="border: 5px solid #c5c5c5;border-radius:5px;" styleClass="image-produto"
										rendered="#{pDVBean.itemVenda.produto.id == null}" />
										
									<p:graphicImage url="#{pDVBean.itemVenda.produto.urlImagem}" styleClass="image-produto"
										style="border: 5px solid #c5c5c5;border-radius:5px;"
										rendered="#{pDVBean.itemVenda.produto.id != null}" />
								

									<p:panelGrid columns="1" layout="grid" style="margin-top:15px;"
										styleClass="panelgrid-noborder disabled disabled panel-desc"
										columnClasses="ui-grid-col-12">

										<p:outputLabel
											value="0 Un."
											style="font-size: 9px;font-weight: bold;float: left;background: #29b140;color: white;padding: 1px;margin-top: -13px; margin-right: -2px;"
											rendered="#{pDVBean.itemVenda.produto.id == null}" />
									
										<p:outputLabel
											value="#{pDVBean.itemVenda.produto.quantidadeAtual} Un."
											style="font-size: 9px;font-weight: bold;float: left;background: #29b140;color: white;padding: 1px;margin-top: -13px; margin-right: -2px;"
											rendered="#{pDVBean.itemVenda.produto.id != null}" />
										
											
										<p:outputLabel
											value="Nome do produto."
											style="font-size: 16px;font-weight: bold;"
											rendered="#{pDVBean.itemVenda.produto.id == null}" />
											
										<p:outputLabel
											value="#{pDVBean.itemVenda.produto.nome}"
											style="font-size: 16px;font-weight: bold;"
											rendered="#{pDVBean.itemVenda.produto.id != null}" />
											
										<p:outputLabel
											value="Leia o código de barras ou informe a descrição do produto."
											style="font-size: 22px;font-weight: bold;float: left;margin-top: -5px;"
											rendered="#{pDVBean.itemVenda.produto.id == null}" />
											
										<p:outputLabel
											value="#{pDVBean.itemVenda.produto.descricao}"
											style="font-size: 22px;font-weight: bold;float: left;margin-top: -5px;"
											rendered="#{pDVBean.itemVenda.produto.id != null}" />
											

										<p:outputLabel value="cod.: 0000" rendered="#{pDVBean.itemVenda.produto.id == null}" />
										
										<p:outputLabel value="cod.: #{pDVBean.itemVenda.produto.codigo}" rendered="#{pDVBean.itemVenda.produto.id != null}" />

										<p:spacer />

										<p:outputLabel value="Valor unitário"
											style="font-weight: bold;font-size: 12px;" />

										<p:outputLabel value="R$ 0,00"
											style="font-size: 28px;font-weight: bold;float: left;margin-top: -6px;"
											rendered="#{pDVBean.itemVenda.produto.id == null}" />
											
										<p:outputLabel id="preco-unitario" value="#{pDVBean.itemVenda.produto.precoDeVenda}"
											style="font-size: 28px;font-weight: bold;float: left;margin-top: -6px;"
											rendered="#{pDVBean.itemVenda.produto.id != null}">
											
											<f:convertNumber type="currency" />
										</p:outputLabel>

									</p:panelGrid>

								</p:panelGrid>

								<p:panelGrid columns="2" layout="grid"
									style="margin-bottom: 5px" rendered="false"
									styleClass="panelgrid-noborder disabled disabled"
									columnClasses="ui-grid-col-4, ui-grid-col-4">

									<p:outputLabel value="Código" for="codigo" />
									<p:inputText id="codigo"
										value="#{pDVBean.itemVenda.produto.codigo}"
										readonly="true" />

									<p:outputLabel value="Descrição" for="descricao" />
									<p:inputText id="descricao"
										value="#{pDVBean.itemVenda.produto.descricao}"
										readonly="true" />

									<p:outputLabel value="Fornecedor" for="fornecedor" />
									<p:inputText id="fornecedor"
										value="#{pDVBean.itemVenda.produto.fornecedor.nome}"
										readonly="true" />
								</p:panelGrid>

								<p:panelGrid id="panel-lote" columns="2" layout="grid"
									style="margin-bottom: 5px;display:none;" 
									styleClass="panelgrid-noborder disabled disabled"
									columnClasses="ui-grid-col-4, ui-grid-col-6">

									<p:outputLabel value="Qtd. Disponível" for="lote" />
									<p:selectOneMenu id="lote"
										value="#{pDVBean.itemCompra}"
										placeholder="selecione">

										<f:selectItem itemLabel="Selecione" />

										<p:ajax event="change" process="@this" />

										<f:selectItems value="#{pDVBean.itensCompra}"
											var="itemCompra"
											itemLabel="#{itemCompra.quantidadeDisponivel ge 2 ? ''.concat(itemCompra.quantidadeDisponivel).concat(' Itens | Compra: ').concat(itemCompra.compra.dataCompraFormatada).concat(' | ').concat(itemCompra.valorUnitarioFormatado) : ''.concat(itemCompra.quantidadeDisponivel).concat(' Item | Compra: ').concat(itemCompra.compra.dataCompraFormatada).concat(' | ').concat(itemCompra.valorUnitarioFormatado) }"
											itemValue="#{itemCompra}" />
									</p:selectOneMenu>
								</p:panelGrid>


								<p:panelGrid columns="3" layout="grid"
									style="margin-top:10px;" id="campos-valor"
									styleClass="panelgrid-noborder disabled disabled campos-valor"
									columnClasses="ui-grid-col-4, ui-grid-col-4">

									<p:panelGrid columns="1" layout="grid"
										style="margin-bottom: 5px"
										styleClass="panelgrid-noborder disabled disabled"
										columnClasses="ui-grid-col-12">

										<p:outputLabel value="Quantidade" for="quantidade" />
										<p:inputNumber id="quantidade" decimalPlaces="0" readonly="#{pDVBean.itemVenda.id != null}"
											placeholder="0" styleClass="quantidade" onkeyup="ajaxDelay('')"
											value="#{pDVBean.itemVenda.quantidade}">

											<p:ajax event="keyup" process="@this" update="btn-adicionar"></p:ajax>
										</p:inputNumber>
									</p:panelGrid>

									<p:panelGrid columns="1" layout="grid"
										style="margin-bottom: 5px"
										styleClass="panelgrid-noborder disabled disabled"
										columnClasses="ui-grid-col-12">

										<p:outputLabel value="Valor Unitário" for="valor-unitario" />
										<p:inputNumber id="valor-unitario" decimalPlaces="2" styleClass="valor-unitario"
											placeholder="R$ 0,00" symbol="R$ " readonly="true"
											value="#{pDVBean.itemVenda.produto.precoDeVenda}">
										</p:inputNumber>
									</p:panelGrid>

									<p:panelGrid columns="1" layout="grid"
										style="margin-bottom: 5px"
										styleClass="panelgrid-noborder disabled disabled subtotal"
										columnClasses="ui-grid-col-12">

										<p:outputLabel value="Total sem Desconto" for="valor-total" />
										<p:inputNumber id="valor-total" decimalPlaces="2" styleClass="sub-total"
											readonly="true" placeholder="R$ 0,00" symbol="R$ "
											value="#{pDVBean.itemVenda.produto.precoDeVenda * pDVBean.itemVenda.quantidade}" />

									</p:panelGrid>

								</p:panelGrid>
								
								<p:panelGrid columns="3" layout="grid"
									style="margin-top:-5px;" id="margem-desconto"
									styleClass="panelgrid-noborder disabled disabled campos-percentual"
									columnClasses="ui-grid-col-4, ui-grid-col-4">
									
									

									<p:panelGrid columns="1" layout="grid"
										style="margin-bottom: 5px" rendered="false"
										styleClass="panelgrid-noborder disabled disabled"
										columnClasses="ui-grid-col-12">

										<p:outputLabel value="Margem" />
										<p:panel styleClass="margem">
											<h:outputText id="margemEmDinheiro" styleClass="margem-em-dinheiro"
												value="#{(pDVBean.itemVenda.quantidade > 0) ? pDVBean.itemVenda.produto.margemLucroEmDinheiro * pDVBean.itemVenda.quantidade : pDVBean.itemVenda.produto.margemLucroEmDinheiro}"
												style="font-weight: bold;font-size: 10px;float: right;margin-top: -17px;margin-right: 6px;color: #757575;">
												
												<f:convertNumber type="currency" />
											</h:outputText>
										
											<h:outputText id="margem"
												value="%#{pDVBean.itemVenda.produto.margemLucro}"
												style="font-weight: bold; font-size: 18px" />
											<h:inputHidden id="margem-lucro"  readonly="#{pDVBean.itemVenda.id != null}"
												value="#{pDVBean.itemVenda.produto.margemLucro}" />
											<p:slider for="margem-lucro" display="margem" onSlideEnd="ajaxDelay('');"
												displayTemplate="%{value}" minValue="0" maxValue="300">
			
												<p:ajax event="slideEnd" update="preco-unitario valor-unitario"
													process="@this margem margem-lucro"  />
											</p:slider>
										</p:panel>
									</p:panelGrid>

									<p:panelGrid columns="1" layout="grid"
										style="margin-bottom: 5px" id="panel-desconto"
										styleClass="panelgrid-noborder disabled disabled"
										columnClasses="ui-grid-col-12">

										<p:outputLabel value="Desconto" />
										<p:panel styleClass="desconto">
											<h:outputText id="descontoEmDinheiro" styleClass="desconto-em-dinheiro"
												value="#{(pDVBean.itemVenda.produto.precoDeVenda * pDVBean.itemVenda.quantidade * pDVBean.itemVenda.desconto) / 100}"
												style="font-weight: bold;font-size: 10px;float: right;margin-top: -17px;margin-right: 6px;color: #757575;">
											
												<f:convertNumber type="currency" />
											</h:outputText>
											
											<h:outputText id="desconto" styleClass="label-desconto"
												value="%#{pDVBean.itemVenda.desconto}" 
												style="font-weight: bold; font-size: 18px;display:none;" />
											<h:inputHidden id="percentual-desconto"
												value="#{pDVBean.itemVenda.desconto}" />
												
											<p:inputNumber id="input-desconto" thousandSeparator="," decimalSeparator="." symbol="% "
												value="#{pDVBean.itemVenda.desconto}" decimalPlaces="0" onkeyup="ajaxDelay_();"
												minValue="0" maxValue="#{pDVBean.itemVenda.produto.descontoMaximo}" 
												styleClass="input-desconto" disabled="#{pDVBean.itemVenda.id != null}">
												
												<p:ajax event="change" process="@this percentual-desconto margem margem-lucro" 
													update="percentual-desconto desconto margem margem-lucro slide-desconto descontoEmDinheiro"  />
											</p:inputNumber>
											<p:slider style="display:none;" id="slide-desconto" for="percentual-desconto" display="desconto" onSlideEnd="ajaxDelay('');" 
												displayTemplate="%{value}" minValue="0" maxValue="#{pDVBean.itemVenda.produto.descontoMaximo}">
			
												<p:ajax event="slideEnd" update="input-desconto"
													process="@this desconto percentual-desconto  margem margem-lucro" />
											</p:slider>
										</p:panel>
									</p:panelGrid>
									
									<p:outputLabel value="" />

									<p:panelGrid columns="1" layout="grid"
										style="margin-bottom: 5px"
										styleClass="panelgrid-noborder disabled disabled subtotal"
										columnClasses="ui-grid-col-12">

										<p:outputLabel value="Sub-Total" />
										<p:panel>
											<h:outputText id="lucroEmDinheiro" styleClass="lucro-em-dinheiro"
												value="#{pDVBean.itemVenda.lucro == null ? 0 : pDVBean.itemVenda.lucro}"
												rendered="#{seguranca.acessoAdministrador() or seguranca.acessoUsuarioAvancado()}"
												style="font-weight: bold;font-size: 10px;float: right;margin-top: -17px;margin-right: 6px;color: #757575;">
											
												<f:convertNumber type="currency" />
											</h:outputText>
										
											<h:outputText 
													value="#{pDVBean.itemVenda.produto.precoDeVenda * pDVBean.itemVenda.quantidade - ((pDVBean.itemVenda.produto.precoDeVenda * pDVBean.itemVenda.quantidade * pDVBean.itemVenda.desconto) / 100)}" styleClass="total-com-desconto"
													style="font-weight: bold;font-size: 26px;float: right;margin-top: 2px;color: #0e6ace;border: 1px solid;padding: 0px 5px 0px 5px;border-radius: 2px;margin-right: 1px;">
												
												<f:convertNumber type="currency" />
											</h:outputText>		
										</p:panel>								
																						
									</p:panelGrid>

								</p:panelGrid>
								
								<p:panelGrid columns="1" layout="grid" id="panel-obs" rendered="false"
									styleClass="panelgrid-noborder disabled disabled"
									columnClasses="ui-grid-col-12">

									<p:inputTextarea id="observacao" placeholder="Observações"
										value="#{pDVBean.itemVenda.observacoes}" />
								</p:panelGrid>
								
								<p:panelGrid columns="2" layout="grid"
									styleClass="panelgrid-noborder disabled disabled"
									columnClasses="ui-grid-col-8, ui-grid-col-4">

									<p:outputLabel />
									<p:commandButton id="btn-adicionar" value="Adicionar"
										onstart="PF('downloadLoading').show();"
										disabled="#{(not seguranca.acessoAdministrador() and not seguranca.acessoUsuarioAvancado() and not seguranca.acessoVendedor()) or pDVBean.itemVenda.quantidade le 0}"
										onsuccess="PF('downloadLoading').hide();" icon="fa fa-arrow-right" iconPos="right"
										update="msg tabView codigo lucroEmDinheiro descricao fornecedor form:total-venda id valor-unitario quantidade valor-total form:panel-table lote "
										action="#{pDVBean.adicionarItem}"
										process="@this input-desconto codigo valor-unitario quantidade valor-total id lote percentual-desconto observacao"
										style="font-weight: bold;">
									</p:commandButton>
								</p:panelGrid>

							</p:tab>

							<p:tab title="Dados da venda" titleStyleClass="tabs" 
								id="tab-despesa">

								<h3 style="font-weight: bold">Dados da Venda</h3>

								<p:panelGrid columns="2" layout="grid"
									styleClass="panelgrid-noborder disabled disabled"
									columnClasses="ui-grid-col-4, ui-grid-col-4">

									<p:outputLabel value="Venda N." />
									<p:inputText value="#{pDVBean.venda.numeroVenda}"
										readonly="true" placeholder="Gerado automaticamente." />

									<p:outputLabel value="Data da Venda" for="data-venda" />
									<p:datePicker value="#{pDVBean.venda.dataVenda}" styleClass="data-venda"
										readonlyInput="true" id="data-venda" pattern="dd/MM/yyyy"
										locale="pt" showIcon="true"
										disabled="#{not seguranca.acessoAdministrador() and not seguranca.acessoUsuarioAvancado()}" />

									<p:outputLabel value="Tipo de Venda" for="tipo-venda" />
									<p:selectOneMenu id="tipo-venda"
										value="#{pDVBean.venda.tipoVenda}"
										placeholder="selecione">

										<f:selectItem itemLabel="Selecione" />

										<f:selectItems value="#{pDVBean.todosTiposVendas}"
											var="tipoVenda" itemLabel="#{tipoVenda.descricao}"
											itemValue="#{tipoVenda}" />
									</p:selectOneMenu>

									<p:outputLabel value="Bairro" for="bairro" />
									<p:autoComplete id="bairro" forceSelection="true"
										dropdown="true" scrollHeight="210" styleClass="bairro"
										value="#{pDVBean.venda.bairro}" var="bairro"
										itemLabel="#{bairro.nome}" itemValue="#{bairro}"
										completeMethod="#{pDVBean.completeText}">
										
										<p:ajax event="itemSelect" process="@this" listener="#{pDVBean.calculaAcrescimo}" update="taxa-entrega form:taxa-de-entrega form:total-venda" />
									</p:autoComplete>

									<p:outputLabel value="Vendedor" for="vendedor" />
									<p:selectOneMenu id="vendedor" styleClass="vendedor"
										disabled="#{not seguranca.acessoAdministrador() and not seguranca.acessoUsuarioAvancado()}"
										value="#{pDVBean.venda.usuario}"
										placeholder="selecione">

										<f:selectItem itemLabel="Selecione" />

										<f:selectItems value="#{pDVBean.todosUsuarios}"
											var="vendedor" itemLabel="#{vendedor.nome}"
											itemValue="#{vendedor}" />
									</p:selectOneMenu>
								</p:panelGrid>

								
								<h3 style="font-weight: bold">Entrega</h3>
								
								<p:panelGrid columns="3" layout="grid" id="panel-entrega" rendered="true"
									styleClass="panelgrid-noborder disabled disabled panel-entrega"
									columnClasses="ui-grid-col-4, ui-grid-col-2, ui-grid-col-4">

									<p:outputLabel value="Venda para entrega?" for="entrega" />
									<p:inputSwitch offLabel="Não" onLabel="Sim" id="entrega" style="width:150px"
										value="#{pDVBean.entrega}">

										<p:ajax process="@this" listener="#{pDVBean.calculaAcrescimo}" update="@parent taxa-entrega form:sub-total_ form:taxa-de-entrega form:total-venda" />
									</p:inputSwitch>

									<p:commandLink styleClass="btn-new entrega" id="localizacao"
										update="entrega-dialog" value="Dados da entrega"
										onstart="PF('downloadLoading').show();"
										oncomplete="PF('downloadLoading').hide();PF('entrega-dialog').show()"
										process="@this" disabled="#{not pDVBean.entrega}" />
										
										
									<p:outputLabel value="Taxa de Entrega" for="taxa-entrega" />				
									<p:inputNumber id="taxa-entrega" decimalPlaces="2"
										placeholder="R$ 0,00" autocomplete="off" 
										symbol="R$ " readonly="true"
										value="#{pDVBean.venda.taxaDeEntrega}">
									</p:inputNumber>
								</p:panelGrid>
								
								
								
								<p:panelGrid columns="2" layout="grid" id="panel-endereco" rendered="true"
									styleClass="panelgrid-noborder disabled disabled panel-info-entrega"
									columnClasses="ui-grid-col-4, ui-grid-col-8" style="display:none;">
									
									<p:outputLabel value="" />	
										
									<p:fieldset collapsed="true" style="margin-left: 0px;" legend="Informações de entrega" toggleable="true" toggleSpeed="500">
								        <p:ajax event="toggle" listener="#{fieldsetView.handleToggle}" />
								        
										<p:panelGrid columns="2" layout="grid" style="font-size:12px;"
											styleClass="panelgrid-noborder disabled disabled"
											columnClasses="ui-grid-col-6, ui-grid-col-6">
											
											<p:panelGrid columns="1" layout="grid"
												styleClass="panelgrid-noborder disabled disabled grid-card"
												columnClasses="ui-grid-col-12">
										
												<p:outputLabel value="Nome" style="font-weight: normal;font-size: 14px;" /> 
												<p:inputText id="nome" style="width:100%;text-align:left;"
													requiredMessage="Nome deve ser informado." required="true" label="Nome"
													value="#{pDVBean.entregaVenda.nome}" placeholder="Nome" maxlength="120" />
													
											</p:panelGrid>
								
												
											<p:panelGrid columns="1" layout="grid"
												styleClass="panelgrid-noborder disabled disabled grid-card"
												columnClasses="ui-grid-col-12">
										
												<p:outputLabel value="Telefone" style="font-weight: normal;font-size: 14px;" /> 
												<p:inputMask id="telefone" style="width:100%;text-align:left;" 
													mask="(99) 99999-9999" autoClear="false"
													requiredMessage="Telefone deve ser informado." required="true" label="Telefone"
													value="#{pDVBean.entregaVenda.nome}" placeholder="Telefone" />
													
											</p:panelGrid>
												
										</p:panelGrid>
										
										
										<p:panelGrid columns="3" layout="grid" style="font-size:12px;"
											styleClass="panelgrid-noborder disabled disabled" id="panel-endereco2"
											columnClasses="ui-grid-col-3, ui-grid-col-7, ui-grid-col-2">
											
											<p:panelGrid columns="1" layout="grid"
												styleClass="panelgrid-noborder disabled disabled grid-card"
												columnClasses="ui-grid-col-12">
										
												<p:outputLabel value="CEP" style="font-weight: normal;font-size: 14px;" />
												<p:inputMask id="cep" style="width:100%;text-align:left;"
													mask="99999-999" autoClear="false" placeholder="CEP"
													requiredMessage="CEP deve ser informado." required="true" label="CEP"
													value="#{pDVBean.entregaVenda.nome}">
													
													<p:ajax event="blur" onstart="start__();" oncomplete="stop__();" process="@this" update="endereco bairro" listener="#{carrinhoBean.buscaEnderecoPorCEP}" />
												</p:inputMask>
												
											</p:panelGrid>
							
											<p:panelGrid columns="1" layout="grid"
												styleClass="panelgrid-noborder disabled disabled grid-card"
												columnClasses="ui-grid-col-12">
										
												<p:outputLabel value="Endereço" style="font-weight: normal;font-size: 14px;" />
												<p:inputText id="endereco" style="width:100%;text-align:left;"
													requiredMessage="Endereço deve ser informado." required="true" label="Endereço"
													value="#{pDVBean.entregaVenda.nome}" placeholder="Endereço" />
													
											</p:panelGrid>
											
											<p:panelGrid columns="1" layout="grid"
												styleClass="panelgrid-noborder disabled disabled grid-card"
												columnClasses="ui-grid-col-12">
										
												<p:outputLabel value="Nº" style="font-weight: normal;font-size: 14px;" />
												<p:inputText id="numero" style="width:100%;text-align:left;"
													requiredMessage="Número deve ser informado." required="true" label="Número"
													value="#{pDVBean.entregaVenda.nome}" placeholder="Nº" />
													
											</p:panelGrid>
													
										</p:panelGrid>
						
										
										<p:panelGrid columns="2" layout="grid" style="font-size:12px;"
											styleClass="panelgrid-noborder disabled disabled" id="panel-endereco_"
											columnClasses="ui-grid-col-8, ui-grid-col-4">
											
											<p:panelGrid columns="1" layout="grid"
												styleClass="panelgrid-noborder disabled disabled grid-card"
												columnClasses="ui-grid-col-12">
										
												<p:outputLabel value="Complemento" style="font-weight: normal;font-size: 14px;" />
												<p:inputText id="complemento" style="width:100%;text-align:left;"
													value="#{pDVBean.entregaVenda.nome}" placeholder="Complemento" />
													
											</p:panelGrid>
														
											<p:panelGrid columns="1" layout="grid"
												styleClass="panelgrid-noborder disabled disabled grid-card"
												columnClasses="ui-grid-col-12">
										
												<p:outputLabel value="Bairro" style="font-weight: normal;font-size: 14px;" />
												<p:inputText id="bairro2" style="width:100%;text-align:left;"
													value="#{pDVBean.entregaVenda.nome}" placeholder="Bairro"
													label="Bairro"
													requiredMessage="Bairro deve ser informado." required="true" />
																				
											</p:panelGrid>
						
										</p:panelGrid>
								    </p:fieldset>
								</p:panelGrid>
								
								
								<h3 style="font-weight: bold">Pagamento</h3>
								
								<p:panelGrid columns="2" layout="grid" id="forma-pagamento" rendered="true"
									styleClass="panelgrid-noborder disabled disabled panel-entrega"
									columnClasses="ui-grid-col-4, ui-grid-col-4">

									<p:outputLabel value="Selecione a forma de pagamento" />				
									<p:selectOneMenu id="formas-pagamentos" value="#{pDVBean.venda.formaPagamento}">
							            
							            <p:ajax event="change" update="form:total-venda acrescimo form:total-acrescimos" process="@this" listener="#{pDVBean.calculaAcrescimo}" onstart="PF('downloadLoading').show();" oncomplete="PF('downloadLoading').hide();" />
							            
							            <f:selectItems value="#{pDVBean.todasFormasPagamentos}" var="formaPagamento" itemLabel="#{formaPagamento.nome}" itemValue="#{formaPagamento}"/>
							        </p:selectOneMenu>							     							        
								</p:panelGrid>
								
								<p:panelGrid columns="3" layout="grid" id="panel-acrescimo" rendered="true"
									styleClass="panelgrid-noborder disabled disabled panel-entrega"
									columnClasses="ui-grid-col-4, ui-grid-col-2, ui-grid-col-4"
									style="margin-top:5px;">

									<p:outputLabel value="Acréscimo" for="acrescimo" />	
									<p:inputNumber id="acrescimo" decimalPlaces="2"
										placeholder="% 0,00" autocomplete="off" 
										symbol="% " readonly="true"
										value="#{pDVBean.venda.formaPagamento.acrescimo}">
									</p:inputNumber>
								</p:panelGrid>

								<p:panelGrid columns="2" layout="grid" id="panel-ajuste"
									rendered="false"
									styleClass="panelgrid-noborder disabled disabled panel-ajuste"
									columnClasses="ui-grid-col-4, ui-grid-col-8">

									<p:outputLabel value="Ajuste de estoque" for="ajuste" />
									<p:selectBooleanCheckbox id="ajuste" style="margin-bottom: 9px;"
										value="#{pDVBean.venda.ajuste}" disabled="#{pDVBean.venda.id != null}">

										<p:ajax process="@this" update="@parent" />
									</p:selectBooleanCheckbox>
									
									<p:outputLabel value="Deseja recuperar os valores de custo médio dos produtos desta venda?" rendered="#{pDVBean.venda.ajuste}" />
									<p:inputSwitch offLabel="Não" onLabel="Sim" id="recuperar" style="width:150px"
										value="#{pDVBean.venda.recuperarValores}" rendered="#{pDVBean.venda.ajuste}"
										disabled="#{pDVBean.venda.id != null}">

										<p:ajax process="@this" update="@parent" />
									</p:inputSwitch>
									
									<p:outputLabel rendered="#{pDVBean.venda.ajuste and pDVBean.venda.recuperarValores}" />
									<p:outputLabel value="Ok, então os valores de custo médio de cada produto dessa venda poderão ser somados aos valores totais de custo de suas próximas entradas."
										rendered="#{pDVBean.venda.ajuste and pDVBean.venda.recuperarValores}" />
								
								</p:panelGrid>
				

								<p:panelGrid columns="2" layout="grid"
									style="margin-bottom: 5px"
									styleClass="panelgrid-noborder disabled disabled"
									rendered="false" columnClasses="ui-grid-col-4, ui-grid-col-4">

									<p:outputLabel value="Quantidade de itens" for="itens" />
									<p:inputNumber id="itens" decimalPlaces="0" readonly="true"
										placeholder="0"
										value="#{pDVBean.venda.quantidadeItens}" />

									<p:outputLabel value="Valor total" for="total" />
									<p:inputNumber id="total" decimalPlaces="0" readonly="true"
										placeholder="0" value="#{pDVBean.venda.valorTotal}" />
								</p:panelGrid>

							</p:tab>
						</p:tabView>

					</p:panel>


					<p:panel class="card card-w-title ui-fluid itens-add panel-right"
						id="panel-table" style="padding-bottom: 0px !important;" styleClass="panel-itenstable">

						<p style="font-weight: bold; margin-left: 4px;">Itens
							adicionados</p>

						<p:panelGrid columns="1" layout="grid"
							styleClass="panelgrid-noborder disabled disabled"
							columnClasses="ui-grid-col-12">

							<p:dataTable id="itensTable" paginatorAlwaysVisible="false"
								scrollable="true" scrollHeight="280" value="#{pDVBean.itensVenda}"
								var="item" emptyMessage="Nenhum item adicionado." reflow="true"
								paginator="false" rowKey="#{item.code}"
								selection="#{pDVBean.itemSelecionado}"
								selectionMode="single">

								<p:column headerText="Nome do produto" width="30%">
									<h:outputText value="#{item.produto.descricao}" />
								</p:column>

								<p:column headerText="Qtde." width="10%">
									<h:outputText value="#{item.quantidade}" />
								</p:column>

								<p:column headerText="Preço Un." width="15%">
									<h:outputText value="#{item.valorUnitario}">
										<f:convertNumber type="currency" />
									</h:outputText>
								</p:column>

								<p:column headerText="Sub-Total" width="15%">
									<h:outputText value="#{item.total}">
										<f:convertNumber type="currency" />
									</h:outputText>
								</p:column>
								
								<p:column headerText="Margem" width="12%" rendered="false">
									<h:outputText value="#{item.percentualLucro}%">
										<f:convertNumber pattern="#0.00" />
									</h:outputText>
								</p:column>
								
								<p:column headerText="Lucro" width="15%" rendered="false">
									<h:outputText value="#{item.lucro}">
										<f:convertNumber type="currency" />
									</h:outputText>
								</p:column>			
								
								<p:column headerText="Desc." width="20%" rendered="false">
									<h:outputText value="#{item.desconto}%">
										<f:convertNumber pattern="#0.00" />
									</h:outputText>
								</p:column>
					
								<p:column headerText="Obs." width="8%" rendered="false">
									<h:outputText value="#{item.observacoes}" />
								</p:column>

							</p:dataTable>
						</p:panelGrid>

						<p:contextMenu id="menu-item" for="itensTable">
							<p:menuitem value="Remover Item" id="btn-remove"
								update="panel-table tabView tabView:id tabView:codigo tabView:descricao tabView:fornecedor tabView:lote total-venda"
								process="@this panel-table"
								action="#{pDVBean.removeItem}" onstart="start();"
								oncomplete="stop();" icon="fa fa-fw fa-trash"
								disabled="#{pDVBean.itensVendaSize eq 0}" />

							<p:menuitem value="Editar Item" id="btn-editar"
								update="panel-table tabView tabView:id tabView:codigo total-venda tabView:descricao tabView:fornecedor tabView:valor-unitario tabView:quantidade tabView:percentual-desconto tabView:valor-total tabView:lote "
								process="@this panel-table"
								action="#{pDVBean.editarItem}" onstart="start();"
								oncomplete="stop();" icon="fa fa-fw fa-edit"
								disabled="#{pDVBean.itensVendaSize eq 0}" />
								
							<p:menuitem value="Detalhar Item" id="btn-detalhe"
								update="panel-table tabView tabView:id tabView:codigo total-venda tabView:descricao tabView:fornecedor tabView:valor-unitario tabView:quantidade tabView:percentual-desconto tabView:valor-total tabView:lote "
								process="@this panel-table"
								action="#{pDVBean.detalharItem}" onstart="start();"
								oncomplete="stop();" icon="fa fa-fw fa-list"
								rendered="#{pDVBean.venda.id != null}" />
						</p:contextMenu>
						
						<p:panel class="card card-w-title ui-fluid panel-total-geral">
						
							<p:panelGrid columns="2" layout="grid"
								styleClass="panelgrid-noborder disabled disabled"
								columnClasses="ui-grid-col-6, ui-grid-col-6">
							
								<p:panel>
									<p:panel>
										<p:outputLabel value="Total de itens: " style="font-size: 12px;color:#5b5656;margin-left: 2px;font-weight:bold;" />
										<p:outputLabel id="total-itens"
											value="#{pDVBean.venda.quantidadeItens}"
											style="font-size: 13px;font-weight:bold;color:#75767dc9;">
										</p:outputLabel>
									</p:panel>
									
									<p:panel style="margin-bottom: 5px;">	
										<p:outputLabel value="Total de desconto: " style="font-size: 12px;color:#5b5656;margin-left: 2px;font-weight:bold;" />
										<p:outputLabel id="total-desconto"
											value="#{pDVBean.venda.totalDescontoEmDinheiro}"
											style="font-size: 13px;font-weight:bold;color:#75767dc9;">
											
											<f:convertNumber type="currency" />
										</p:outputLabel>
										<p:outputLabel 
											value=" (#{pDVBean.venda.totalDesconto}%)"
											style="font-size: 13px;font-weight:bold;color:#75767dc9;">
										</p:outputLabel>
									</p:panel>
									
									<p:panel styleClass="sub_total">
										<p:outputLabel value="Sub-Total: " style="font-size: 12px;color:#5b5656;margin-left: 2px;font-weight:bold;" />
										<p:outputLabel id="sub-total_"
											value="#{pDVBean.venda.id != null ? (pDVBean.venda.valorTotal - pDVBean.totalDeAcrescimo - pDVBean.venda.taxaDeEntrega) : (pDVBean.venda.valorTotal - pDVBean.totalDeAcrescimo - pDVBean.venda.taxaDeEntrega)}"
											style="font-size: 13px;font-weight:bold;color:#75767dc9;">
											
											<f:convertNumber type="currency" />
										</p:outputLabel>
									</p:panel>
								</p:panel>
								
								<p:panel>
									<p:panel>
										<p:outputLabel value="Total de acréscimos: " style="font-size: 12px;color:#5b5656;margin-left: 2px;font-weight:bold;" />
										<p:outputLabel id="total-acrescimos"
											value="#{pDVBean.totalDeAcrescimo}"
											style="font-size: 13px;font-weight:bold;color:#75767dc9;">
											
											<f:convertNumber type="currency" />
										</p:outputLabel>
									</p:panel>
									
									<p:panel style="margin-bottom: 10px;">
										<p:outputLabel value="Taxa de Entrega: " style="font-size: 12px;color:#5b5656;margin-left: 2px;font-weight:bold;" />
										<p:outputLabel id="taxa-de-entrega"
											value="#{pDVBean.venda.taxaDeEntrega == null ? 'R$ 0,00' : pDVBean.venda.taxaDeEntrega}"
											style="font-size: 13px;font-weight:bold;color:#75767dc9;">
											
											<f:convertNumber type="currency" />
										</p:outputLabel>
									</p:panel>
									
									<p:panel style="margin-bottom: 15px;" rendered="#{pDVBean.venda.id != null}">
										<p:outputLabel value="Lucro total: " style="font-size: 12px;color:#5b5656;margin-left: 2px;font-weight:bold;" />
										<p:outputLabel id="lucro-total"
											value="#{(pDVBean.venda.lucro + pDVBean.venda.estorno)}"
											style="font-size: 13px;font-weight:bold;color:#75767dc9;">
											
											<f:convertNumber type="currency" />
										</p:outputLabel>
										
										<p:outputLabel value=" | Estorno: " style="font-size: 12px;color:#5b5656;margin-left: 2px;font-weight:bold;" />
										<p:outputLabel
											value="#{pDVBean.venda.estorno}"
											style="font-size: 13px;font-weight:bold;color:#75767dc9;">
											
											<f:convertNumber type="currency" />
										</p:outputLabel>
									</p:panel>
							
								</p:panel>
							
							</p:panelGrid>

							<div
								class="line-total"></div>
								
							<p:panelGrid columns="1" layout="grid"
							styleClass="panelgrid-noborder disabled disabled"
							columnClasses="ui-grid-col-12">
							
								<p:outputLabel value="Total a pagar: " style="font-weight:bold;" />
								<p:outputLabel id="total-venda"
									value="#{pDVBean.venda.valorTotal}"
									style="margin-top: -8px;font-size: 36px;margin-bottom:5px; font-weight:bold;margin-left:8px;color:#5b5656">
	
									<f:convertNumber type="currency" />
								</p:outputLabel>
							
							</p:panelGrid>
								
							
							<p:commandButton id="btn-cancelar" value="Cancelar"
								onstart="PF('downloadLoading').show();" icon="fa fa-ban"
								onsuccess="PF('downloadLoading').hide();" styleClass="btn-cancelar"
								disabled="#{pDVBean.venda.id != null}"
								process="@this" onclick="cancelarVenda();" />
							

							<p:commandButton id="btn-calcular" value="Finalizar Venda"
								onstart="PF('downloadLoading').show();" icon="fa fa-check"
								actionListener="#{pDVBean.finalizar}" onclick="selectTab1();"
								onsuccess="PF('downloadLoading').hide();" styleClass="btn-finalizar"
								disabled="#{not seguranca.acessoAdministrador() and not seguranca.acessoUsuarioAvancado() and not seguranca.acessoVendedor()}"
								update="msg confirm-dialog confirmDialog tabView:data-venda tabView:tipo-venda tabView:panel-entrega tabView:panel-ajuste tabView:vendedor tabView:bairro panel-table tabView:id tabView:codigo tabView:descricao tabView:fornecedor tabView:valor-unitario tabView:quantidade tabView:valor-total tabView:lote"
								process="@this panel-table tabView:data-venda tabView:vendedor tabView:bairro tabView:tipo-venda tabView:panel-ajuste" />

						
							<p:graphicImage rendered="false" styleClass="image-delivery" library="manhattan-layout" name="images/delivery.jpg" style="width: 150px;float: right;margin-top: -59px;margin-right: -60px;" />
						</p:panel>

					</p:panel>

				</p:panelGrid>
			</h:form>

		</div>

		<p:dialog header="Buscar produto" widgetVar="item-dialog"
			position="top" style="margin-top: 100px" id="item-dialog"
			resizable="false" modal="true" closeOnEscape="true" responsive="true"
			width="350px">

			<h:form id="form-dialog">

				<div class="ui-g-12 ui-lg-12">
					<p:panel class="card card-w-title ui-fluid"
						style="padding-bottom: 0px;">

						<p:defaultCommand target="pesquisar-button" />

						<p:inputText id="search"
							value="#{pDVBean.filter.descricao}"
							placeholder="Digite o código ou descrição" style="width: 180px" />
						<p:commandButton icon="fa fa-fw fa-search" title="Pesquisar"
							id="pesquisar-button" update="produtosTable"
							style="margin-left: 3px; width: 40px" process="@parent"
							action="#{pDVBean.pesquisar}"
							onstart="PF('downloadLoading').show();"
							oncomplete="PF('downloadLoading').hide();">
						</p:commandButton>

						<p:dataTable id="produtosTable" paginatorAlwaysVisible="false"
							scrollable="true" scrollHeight="337"
							value="#{pDVBean.produtosFiltrados}" var="produto"
							emptyMessage="Nenhum produto encontrado." paginator="false"
							styleClass="produtosTable"
							style="margin-top: 10px;border: 1px solid #147df0;">

							<p:column headerText="Código" width="30%">
								<h:outputText value="#{produto.codigo}" />
							</p:column>

							<p:column headerText="Descrição" width="60%">
								<h:outputText value="#{produto.descricao}" />
							</p:column>

							<p:column width="20%" style="text-align: center">
								<p:commandButton icon="fa fa-fw fa-check"
									action="#{pDVBean.selecionarProduto(produto)}"
									title="Selecionar Produto" styleClass="btn-select"
									update="form:id form:codigo form:descricao form:fornecedor form:valor-unitario form:quantidade form:valor-total form:lote "
									process="@this" onstart="PF('downloadLoading').show();"
									oncomplete="PF('downloadLoading').hide();PF('item-dialog').hide();">
								</p:commandButton>
							</p:column>

						</p:dataTable>
					</p:panel>
				</div>

			</h:form>
		</p:dialog>

		<p:dialog id="entrega-dialog" header="Dados da entrega" modal="true"
			widgetVar="entrega-dialog" draggable="true" width="260"
			closable="false" resizable="false" position="top"
			style="margin-top: 100px">

			<h:form id="form-entrega">

				<p:panel class="card card-w-title ui-fluid"
					style="padding-bottom: 0px; margin-top: 5px;">

					<p:panelGrid columns="1" layout="grid"
						styleClass="panelgrid-noborder disabled disabled"
						columnClasses="ui-grid-col-12">

						<p:outputLabel value="Entregar para:" />
						<p:inputText id="nome"
							value="#{pDVBean.entregaVenda.nome}" placeholder="" />

						<p:outputLabel value="Localização para entrega" style="margin-top: 5px;float: left;" />
						<p:inputTextarea id="localizacao-whatsapp"
							value="#{pDVBean.entregaVenda.localizacao}"
							placeholder="" />

						<p:outputLabel value="Observações gerais" />
						<p:inputTextarea id="observacao"
							value="#{pDVBean.entregaVenda.observacao}"
							placeholder="" />
					</p:panelGrid>
				</p:panel>

				<p:panel styleClass="panelgrid-noborder disabled disabled">
					<p:commandButton icon="fa fa-fw fa-check"
						style="float: right;font-weight: bold;font-size: 13px;margin-top: -6px;margin-bottom:5px;background-color: #089a29c7;position: relative;margin-right: 2px;"
						value="Confirmar" process="@this entrega-dialog form-entrega"
						onstart="start();"
						oncomplete="stop();PF('entrega-dialog').hide();">
					</p:commandButton>

					<p:commandButton icon="fa fa-fw fa-close"
						style="float: right;font-weight: bold;font-size: 13px;margin-top: -6px;margin-bottom:5px;background-color: #ab3705b5;position: relative;margin-right: 3px;"
						value="Cancelar" onstart="start();"
						oncomplete="PF('entrega-dialog').hide();stop();">
					</p:commandButton>
				</p:panel>
			</h:form>
		</p:dialog>
		
		
		
		<p:dialog header="Escanear Barcode" widgetVar="barcode-dialog"  position="top" style="margin-top: 100px"
			id="barcode-dialog" resizable="false" modal="true" width="350px" closable="false" 
			closeOnEscape="true" responsive="true">

			<h:form id="form-dialog2">

				<div class="ui-fluid" style="margin-top: 10px; text-align: center">
					
					<div id="scandit-barcode-picker" style="max-width: 350px; max-height: 100%;"></div>

					<div
						style="width: 80%; margin: auto; border-top: 1px solid #ccc; margin-top: 10px; margin-bottom: 10px"></div>

					<p:commandButton icon="fa fa-fw fa-close" styleClass="btn-close-dlgbarcode"
						style="margin-bottom: 5px;font-weight: bold;width: 100px;background:#e15e5ef0;float: right;"
						value="Fechar" update="barcode-dialog" 
						onstart="PF('downloadLoading').show();" 
						oncomplete="PF('downloadLoading').hide();PF('barcode-dialog').hide();">
					</p:commandButton>
				</div>
			</h:form>
		</p:dialog>
		
		
		
		
		
		<p:dialog header="Confirmação de pagamento" widgetVar="confirmDialog"
			position="top" style="margin-top: 100px;" id="confirmDialog" 
			resizable="false" modal="true" closeOnEscape="true" responsive="true">

			<h:form id="confirm-dialog" style="margin-top: 10px;">
			
				<p:focus for="valor-recebido" />
				
				<p:hotkey bind="ctrl+shift+s" action="#{pDVBean.salvar}" rendered="false"
					update="msg form" onstart="start();" oncomplete="stop();" 
				 	process="@this form confirm-dialog" />
								

				<div class="ui-g-12 ui-lg-12">
					<p:panel class="card card-w-title ui-fluid"
						style="padding-bottom: 0px;margin-bottom: 0px;">

						<div class="ui-g-12 ui-lg-6">
						
							<p:panelGrid columns="2" layout="grid" id="pagamento-grid"
								styleClass="panelgrid-noborder disabled disabled"
								columnClasses="ui-grid-col-7, ui-grid-col-5">
	
								<p:outputLabel style="font-weight: bold" value="Data da compra: "
									rendered="false" /> 
								<p:outputLabel value="#{pDVBean.venda.dataVenda}"
									rendered="false">
									<f:convertDateTime pattern="dd/MM/yyyy" locale="pt" />
								</p:outputLabel>
	
								<p:outputLabel style="font-weight: bold" value="Total a pagar: " />
								<p:outputLabel value="#{pDVBean.venda.valorTotal}" id="valorPagar"
									style="font-weight: bold;font-size: 22px;float: right;margin-top: -7px;">
									<f:convertNumber type="currency" />
								</p:outputLabel>
	
								<p:outputLabel
									style="font-weight: bold;margin-top: 6px;float: left;"
									for="formaPagamento" value="Tipo de pagamento: " />
								<p:selectOneMenu id="formaPagamento"
									value="#{pDVBean.tipoPagamento}" styleClass="tipo-pagamento"
									placeholder="selecione">
	
									<p:ajax event="change" onstart="start();" oncomplete="stop();"
										process="@this"
										listener="#{pDVBean.changeTipoPagamento}"
										update="@parent entrada pagamento_para lbl-pagamento parcela-unica editar-parcelas gerar-parcelas primeira-parcela qtd-parcelas qtd-periodo valor-recebido troco faltando panel-contas panel-confirm form:total-venda form:tabView valorPagar form:total-acrescimos formas-pagamentos_" />
	
									<f:selectItems value="#{pDVBean.tiposPagamentos}"
										var="tipoPagamento" itemLabel="#{tipoPagamento.descricao}"
										itemValue="#{tipoPagamento}" />
								</p:selectOneMenu>
								
								
								<p:outputLabel value="Forma de pagamento:" for="formas-pagamentos_" style="font-weight: bold;margin-top: 4px;float: left;" />				
								<p:selectOneMenu id="formas-pagamentos_" value="#{pDVBean.venda.formaPagamento}" styleClass="forma-pagamento"
										disabled="#{pDVBean.tipoPagamento == 'PARCELADO'}">
						            
						            <p:ajax event="change" update="@parent input-av panel-contas pagamento_para lbl-pagamento parcela-unica faltando troco form:total-venda form:tabView valorPagar form:total-acrescimos" process="@this" listener="#{pDVBean.calculaAcrescimo}" onstart="PF('downloadLoading').show();" oncomplete="PF('downloadLoading').hide();" />
						            
						            <f:selectItems value="#{pDVBean.todasFormasPagamentos}" var="formaPagamento" itemLabel="#{formaPagamento.nome}" itemValue="#{formaPagamento}"/>
						        </p:selectOneMenu>
						        
						        <p:outputLabel value="Saldo p/ troca: " rendered="#{pDVBean.vendaPaga and pDVBean.venda.formaPagamento.nome == 'Dinheiro' and pDVBean.tipoPagamento == 'AVISTA'}" style="font-weight: bold;float: left;position: relative;margin-top: 9px;" />
								<p:outputLabel value="R$ #{pDVBean.saldoParaTrocaEmString}" rendered="#{pDVBean.vendaPaga and pDVBean.venda.formaPagamento.nome == 'Dinheiro' and pDVBean.tipoPagamento == 'AVISTA'}"
									style="font-weight: bold;font-size: 18px;float: right;margin-top: 7px;color: #663399;">
									<f:convertNumber type="currency" />
								</p:outputLabel>
	
							</p:panelGrid>
						</div>

						<div class="ui-g-12 ui-lg-6" style="border-left: 1px solid #c0c0c0;">
							<p:panel id="panel-parcelas" 
								styleClass="panelgrid-noborder disabled disabled panel-parcelas #{pDVBean.tipoPagamento == 'PARCELADO' ? '' : 'hide'}">
	
								<p:panelGrid columns="2" layout="grid" style="margin-top:-31px;"
									styleClass="panelgrid-noborder disabled disabled"
									columnClasses="ui-grid-col-7, ui-grid-col-5">
									
									<p:outputLabel value="" />
									<p:commandLink value="Trocar data" onstart="start();"
										oncomplete="stop();" id="editar-parcelas" 
										icon="fa fa-fw fa-edit" style="margin-top: 10px;float: right;"
										action="#{pDVBean.zerarParcelas}"
										update="@this entrada editar-parcelas 
											gerar-parcelas primeira-parcela 
											qtd-parcelas qtd-periodo btn-salvar"
										disabled="#{not pDVBean.parcelasConfirmadas}" />
																	
									<p:outputLabel for="entrada" rendered="false"
										style="font-weight: bold;margin-top: 0px;float: left;"
										value="Entrada: " />
	
									<p:inputNumber id="entrada" decimalPlaces="2" rendered="false"
										placeholder="R$ 0,00" autocomplete="off" minValue="0"
										symbol="R$ " styleClass="entrada entrada_"
										value="#{pDVBean.valorEntrada}"
										disabled="#{pDVBean.parcelasConfirmadas}">
									</p:inputNumber>
						
									<p:outputLabel style="font-weight: bold;float: left;" value="Primeira parcela: " /> 
									<p:commandLink id="primeira-parcela" value="#{pDVBean.primeiraParcelaEmString}" onstart="start();"
										oncomplete="PF('primeiraParc-dialog').show();stop();"
										actionListener="#{pDVBean.preparaPrimeiraParcela}"
										style="float: right;" process="@this"
										icon="fa fa-fw fa-edit"
										update="primeiraParc-dialog entrada 
											gerar-parcelas primeira-parcela 
											qtd-parcelas qtd-periodo btn-salvar">
									</p:commandLink>
															
								</p:panelGrid>
															
	
								<p:panelGrid columns="2" layout="grid" id="panel-parcelamento" 
									styleClass="panelgrid-noborder disabled disabled"
									columnClasses="ui-grid-col-6, ui-grid-col-6">
	
									<p:outputLabel style="font-weight: bold;float: left;margin-top: 7px;margin-bottom: 3px;"
										value="Parcelamento: " />								
		
									<p:outputLabel />
									
									<p:inputNumber decimalPlaces="0" required="true" id="qtd-parcelas"
										requiredMessage="Quantidade de Parcelas deve ser informado."
										placeholder="Quantidade de Parcelas"
										value="#{pDVBean.parcelas}">
									</p:inputNumber>
	
									<p:selectOneMenu value="#{pDVBean.periodoPagamento}"
										id="qtd-periodo" placeholder="selecione">
	
										<f:selectItems
											value="#{pDVBean.periodosPagamentos}"
											var="periodoPagamento"
											itemLabel="#{periodoPagamento.descricao}"
											itemValue="#{periodoPagamento}" />
									</p:selectOneMenu>
	
								</p:panelGrid>
	
	
	
								<p:panel style="text-align: center;margin-top: 5px;margin-bottom: 5px;"
									styleClass="panelgrid-noborder disabled disabled">
	
									<p:commandButton value="Gerar parcelas" onstart="start();"
										oncomplete="stop();PF('parcelamento-dialog').show();"
										action="#{pDVBean.gerarParcelas}" id="gerar-parcelas"
										process="@this panel-parcelamento qtd-parcelas qtd-periodo entrada"
										update="msg btn-salvar parcelamento-dialog" disabled="#{pDVBean.tipoPagamento != 'PARCELADO'}"
										style="width: 110px; font-weight:bold"></p:commandButton>
								</p:panel>
	
								
							</p:panel>
	
			
							<p:panelGrid columns="2" layout="grid" id="grid-valores" 
								styleClass="panelgrid-noborder disabled disabled grid-valores #{(pDVBean.tipoPagamento == 'AVISTA' and pDVBean.venda.formaPagamento.nome == 'Dinheiro' and pDVBean.vendaPaga or (pDVBean.entrega and pDVBean.venda.formaPagamento.nome == 'Dinheiro' and pDVBean.tipoPagamento == 'AVISTA')) ? '' : 'hide'}"
								columnClasses="ui-grid-col-7, ui-grid-col-5">
								
								<p:outputLabel for="valor-recebido" rendered="#{not pDVBean.entrega}"
										style="font-weight: bold;margin-top: 0px;float: left;"
										value="Valor recebido: " />
										
								<p:outputLabel id="areceber" for="valor-recebido" rendered="#{pDVBean.entrega and not pDVBean.vendaPaga}"
										style="font-weight: bold;margin-top: 0px;float: left;"
										value="Valor a receber: " />
										
								<p:outputLabel id="recebido" for="valor-recebido" rendered="#{pDVBean.entrega and pDVBean.vendaPaga}"
										style="font-weight: bold;margin-top: 0px;float: left;"
										value="Valor recebido: " />
	
								<p:inputNumber id="valor-recebido" decimalPlaces="2"
									placeholder="R$ 0,00" autocomplete="off" 
									symbol="R$ " styleClass="entrada valor-recebido"
									value="#{pDVBean.valorRecebido}">
									
									<p:ajax event="blur" process="@parent" listener="#{pDVBean.calculaTroco}" update="grid-valores" />
								</p:inputNumber>
								
								
								<p:outputLabel for="faltando"
									style="font-weight: bold;margin-top: 0px;float: left;"
									value="Faltando: " />
	
								<p:inputNumber id="faltando" decimalPlaces="2" readonly="true"
									placeholder="R$ 0,00" autocomplete="off" 
									symbol="R$ " styleClass="entrada falta"
									value="#{pDVBean.faltando}">
								</p:inputNumber>
								
								
								<p:outputLabel for="troco"
									style="font-weight: bold;margin-top: 0px;float: left;"
									value="Troco: " />
	
								<p:inputNumber id="troco" decimalPlaces="2" readonly="true"
									placeholder="R$ 0,00" autocomplete="off" 
									symbol="R$ " styleClass="entrada troco"
									value="#{pDVBean.troco}">
								</p:inputNumber>
								
							</p:panelGrid>
							
							
							
							<p:panelGrid columns="2" layout="grid" id="pagamento_para" 
								styleClass="panelgrid-noborder disabled disabled parcela-unica #{(pDVBean.tipoPagamento == 'AVISTA' and pDVBean.venda.formaPagamento.nome == 'Dinheiro' and not pDVBean.vendaPaga and not pDVBean.entrega) ? '' : 'hide'}"
								columnClasses="ui-grid-col-7, ui-grid-col-5">
								
								<p:outputLabel id="lbl-pagamento" style="font-weight: bold;float: left;" value="Pagamento para: "
									rendered="#{pDVBean.venda.formaPagamento.nome eq 'Dinheiro'}" /> 
								<p:commandLink id="parcela-unica" value="#{pDVBean.pagamentoParaEmString}" onstart="start();"
									rendered="#{pDVBean.venda.formaPagamento.nome eq 'Dinheiro'}"
									oncomplete="PF('pagamentoPara-dialog').show();stop();"
									style="float: right;"
									icon="fa fa-fw fa-edit" actionListener="#{pDVBean.preparaPagamentoPara}"
									update="pagamentoPara-dialog form-pagamentoPara:inline">
								</p:commandLink>
							</p:panelGrid>
							
							
							<p:panel id="panel-contas"
								styleClass="panelgrid-noborder disabled disabled panel-confirm">
	
								<p:outputLabel id="label-cp"
									style="font-weight: bold;margin-top: 5px;float: left;margin-left:3px;"
									value="Conta à receber: "
									rendered="#{pDVBean.tipoPagamento == 'PARCELADO'}" />
	
								<p:inputSwitch onLabel="Sim" offLabel="Não" id="input-cp"
									style="float:right;width: 50px !important;margin-right: 2px;margin-top: 4px;"
									value="#{pDVBean.contaAPagar}"
									disabled="#{pDVBean.tipoPagamento == 'PARCELADO'}"
									rendered="#{pDVBean.tipoPagamento == 'PARCELADO'}">
	
									<p:ajax event="change" process="@this" update="@this" />
								</p:inputSwitch>
	
								<p:outputLabel id="label-av"
									style="font-weight: bold;margin-top: 5px;float: left;margin-left:3px;"
									value="PAGO: "
									rendered="#{pDVBean.tipoPagamento == 'AVISTA'}" />
	
								<p:inputSwitch onLabel="Sim" offLabel="Não" id="input-av" styleClass="pag-avista"
									style="float:right;width: 50px !important;margin-right: 2px;margin-top: 4px;"
									value="#{pDVBean.vendaPaga}" disabled="#{pDVBean.venda.formaPagamento.nome != 'Dinheiro' and not pDVBean.entrega}"
									rendered="#{pDVBean.tipoPagamento == 'AVISTA'}">
	
									<p:ajax event="change" process="@this" update="@this pagamento-grid grid-valores pagamento_para valor-recebido" listener="#{pDVBean.changeStatusPago}" onstart="PF('downloadLoading').show();" oncomplete="PF('downloadLoading').hide();" />
								</p:inputSwitch>		
	
							</p:panel>
						</div>
						

						<div
							style="float: left; width: 100%;margin-top: 5px; margin-bottom: 10px; border-top: 1px solid #ccc"></div>

						<p:panel style="text-align: right; margin-top: 80px;"
							id="panel-confirm"
							styleClass="panelgrid-noborder disabled disabled panel-confirm">

							<p:commandButton onstart="PF('downloadLoading').show();"
								oncomplete="PF('downloadLoading').hide();PF('confirmDialog').hide();"
								icon="fa fa-fw fa-close"
								style="width: 100px;margin-right:2px;background: #fd6161;"
								value="Cancelar"></p:commandButton>
							<p:commandButton process="@this form confirm-dialog"
								update="msg form" id="btn-salvar"
								onstart="start();" oncomplete="stop();"
								action="#{pDVBean.salvar}"
								icon="fa fa-fw fa-save"
								disabled="#{not pDVBean.parcelasConfirmadas}"
								style="width: 100px;background-color: #0d8819b5;font-weight:bold"
								value="Salvar"></p:commandButton>
						</p:panel>
					</p:panel>
				</div>

			</h:form>
		</p:dialog>
		
		
		
		<p:dialog id="primeiraParc-dialog" showHeader="false" modal="true"
			widgetVar="primeiraParc-dialog" draggable="false" width="300"
			closable="false" resizable="false" position="top"
			style="margin-top: 132px">

			<h:form id="form-primeiraParc">
				<p:calendar id="inline" mode="inline"
					value="#{pDVBean.primeiraParcela}"
					locale="pt" pattern="dd/MM/yyyy" />

				<p:panel styleClass="panelgrid-noborder disabled disabled">
					<p:commandButton icon="fa fa-fw fa-check"
						style="float: right;font-weight: bold;font-size: 13px;background-color: #089a29c7;position: relative;margin-top: 8px;margin-right: 0px;"
						value="Confirmar"
						process="@this primeiraParc-dialog inline form-primeiraParc"
						action="#{pDVBean.confirmarPrimeiraParcela}" onstart="start();"
						update="confirm-dialog:entrada confirm-dialog:editar-parcelas 
							confirm-dialog:gerar-parcelas confirm-dialog:primeira-parcela 
							confirm-dialog:qtd-parcelas confirm-dialog:qtd-periodo" 
						oncomplete="stop();PF('primeiraParc-dialog').hide();">
					</p:commandButton>

					<p:commandButton icon="fa fa-fw fa-close"
						style="float: right;font-weight: bold;margin-top: 8px;font-size: 13px;background-color: #ab3705b5;position: relative;margin-right: 3px;"
						value="Cancelar" onstart="start();"
						oncomplete="PF('primeiraParc-dialog').hide();stop();">
					</p:commandButton>
				</p:panel>
			</h:form>
		</p:dialog>
		
		
		
		
		<p:dialog id="pagamentoPara-dialog" showHeader="false" modal="true"
			widgetVar="pagamentoPara-dialog" draggable="false" width="300"
			closable="false" resizable="false" position="top"
			style="margin-top: 132px">

			<h:form id="form-pagamentoPara">
				<p:calendar id="inline" mode="inline"
					value="#{pDVBean.pagamentoPara}"
					locale="pt" pattern="dd/MM/yyyy" />

				<p:panel styleClass="panelgrid-noborder disabled disabled">
					<p:commandButton icon="fa fa-fw fa-check"
						style="float: right;font-weight: bold;font-size: 13px;background-color: #089a29c7;position: relative;margin-top: 8px;margin-right: 0px;"
						value="Confirmar"
						process="@this pagamentoPara-dialog inline form-pagamentoPara"
						action="#{pDVBean.confirmarPagamentoPara}" onstart="start();"
						update="confirm-dialog:parcela-unica" 
						oncomplete="stop();PF('pagamentoPara-dialog').hide();">
					</p:commandButton>

					<p:commandButton icon="fa fa-fw fa-close"
						style="float: right;font-weight: bold;margin-top: 8px;font-size: 13px;background-color: #ab3705b5;position: relative;margin-right: 3px;"
						value="Cancelar" onstart="start();"
						oncomplete="PF('pagamentoPara-dialog').hide();stop();">
					</p:commandButton>
				</p:panel>
			</h:form>
		</p:dialog>
		
		
		
		<p:dialog id="parcelamento-dialog" showHeader="false" modal="true"
			widgetVar="parcelamento-dialog" draggable="false" width="300"
			closable="false" resizable="false" position="top"
			style="margin-top: 132px">

			<h:form id="form-parcelamento">
				
				<p:dataTable id="contasTable" paginatorAlwaysVisible="false"
					scrollable="true" scrollHeight="125" editable="true"
					editMode="cell" value="#{pDVBean.todasContas}"
					var="conta" emptyMessage="Nenhuma parcela gerada."
					paginator="false" styleClass="produtosTable"
					style="margin-top: 0px;border: 1px solid #147df0;">

					<p:column headerText="Parcela" width="15%"
						style="text-align: center">
						<h:outputText value="#{conta.parcela}" />
					</p:column>

					<p:column headerText="Valor" width="20%"
						style="text-align: center">

						<h:outputText value="#{conta.valor}">
							<f:convertNumber type="currency" />
						</h:outputText>
					</p:column>

					<p:column headerText="Vencimento" width="20%"
						style="text-align: center">

						<h:outputText value="#{conta.vencimento}">
							<f:convertDateTime pattern="dd/MM/yyyy" locale="pt" />
						</h:outputText>
					</p:column>

				</p:dataTable>

				<p:panel styleClass="panelgrid-noborder disabled disabled">
					<p:commandButton icon="fa fa-fw fa-check"
						style="float: right;font-weight: bold;font-size: 13px;background-color: #089a29c7;position: relative;margin-top: 8px;margin-right: 0px;"
						value="Confirmar" disabled="#{pDVBean.todasContasSize le 0}"
						process="@this parcelamento-dialog form-parcelamento"
						action="#{pDVBean.confirmarParcelas}" onstart="start();"
						update="confirm-dialog:entrada confirm-dialog:editar-parcelas 
						confirm-dialog:gerar-parcelas confirm-dialog:primeira-parcela 
						confirm-dialog:qtd-parcelas confirm-dialog:qtd-periodo 
						confirm-dialog:qtd-parcelas confirm-dialog:btn-salvar" oncomplete="stop();PF('parcelamento-dialog').hide();">
						
					</p:commandButton>

					<p:commandButton icon="fa fa-fw fa-close"
						style="float: right;font-weight: bold;margin-top: 8px;font-size: 13px;background-color: #ab3705b5;position: relative;margin-right: 3px;"
						value="Cancelar" onstart="start();"
						oncomplete="PF('parcelamento-dialog').hide();stop();">
					</p:commandButton>
				</p:panel>
			</h:form>
		</p:dialog>
		
		

		<p:dialog id="downloadLoading" showHeader="false" modal="true"
			widgetVar="downloadLoading" header="Status" draggable="false"
			closable="false" resizable="false">
			<p:graphicImage name="images/loadingbar.gif"
				library="manhattan-layout" width="50" />
		</p:dialog>

	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
		<script type="text/javascript">
			const Toast = Swal.mixin({
			  toast: true,
			  position: 'top-end',
			  showConfirmButton: false,
			  timer: 3000,
			  timerProgressBar: true,
			  onOpen: (toast) => {
			    toast.addEventListener('mouseenter', Swal.stopTimer)
			    toast.addEventListener('mouseleave', Swal.resumeTimer)
			  }
			});
			
			function start() {
				PF('downloadLoading').show();
			}

			function stop() {
				PF('downloadLoading').hide();
			}
			
			function selectTab1() {	
				$('.ui-tabs-nav li:nth-child(2) a').click();
			}
			
			function ocultar() {
				delay(function() { 
						$(".panel-parcelas").addClass("hide");
					}, 500);
			}

			function mostrar() {
				$(".panel-parcelas").removeClass("hide");
			}
			
			
			function ocultarValores() {
				$(".grid-valores").addClass("hide");
				$(".parcela-unica").removeClass("hide");
				
			}

			function mostrarValores() {
				$(".grid-valores").removeClass("hide");
				$(".parcela-unica").addClass("hide");
			}
			
			
			function mostrarParcelaUnica() {
				$(".parcela-unica").removeClass("hide");			
			}
			
			function ocultarParcelaUnica() {
				$(".parcela-unica").addClass("hide");			
			}
			
			
			var delay = (function() {
			    var timer = 0;
			    return function(callback, ms) {
			        clearTimeout (timer);
			        timer = setTimeout(callback, ms);
			    };
			})();
			
			function ajaxDelay_(){
				var desconto_ = $('.campos-percentual .desconto .input-desconto input').val();
				var percentualDesconto = document.querySelector(".label-desconto");
				percentualDesconto.innerText = desconto_.replace(' ','');
				ajaxDelay(desconto_);
			}
			
			function ajaxDelay(desconto_){ 
				var quantidade = $('.quantidade input').val();
				
				quantidade = quantidade.replace('.','');
				
				var valorDeCusto = $('.valor-custo').val();
				var precoDeVenda = $('.preco-venda').val();
				var margem = $('.campos-percentual .margem input').val();
					
				var valorUnitarioTemp = parseFloat(valorDeCusto.replace('R$ ','').replace(',','.'));				
				var valorUnitario = valorUnitarioTemp * (1 + (parseFloat(margem)/100));	
				
				//var margemEmDinheiroTemp = (parseFloat(valorUnitario)) - (valorUnitarioTemp);	
				//var margemEmDinheiro = parseFloat(margemEmDinheiroTemp).toFixed(2) * parseFloat(quantidade);
				
				
				var totalSemDesconto = parseFloat(precoDeVenda).toFixed(2) * parseFloat(quantidade);
				
				if(totalSemDesconto.toString() != 'NaN') { 
					var f = parseFloat(totalSemDesconto).toLocaleString('pt-br',{style: 'currency', currency: 'BRL'});
					$('.sub-total input').val(f);
					
					/*
					f = parseFloat(margemEmDinheiro).toLocaleString('pt-br',{style: 'currency', currency: 'BRL'});
					var margemElement = document.querySelector(".margem-em-dinheiro");					
					
					if(totalSemDesconto > 0) {	
						margemElement.innerText = f;
					} else {						
						margemEmDinheiro = valorDeCusto * (parseFloat(margem)/100);
						f = parseFloat(margemEmDinheiro).toLocaleString('pt-br',{style: 'currency', currency: 'BRL'});
						margemElement.innerText = f;
					}*/
					
					var desconto = $('.campos-percentual .desconto input').val();
					if(desconto_) {
						desconto = desconto_;												
						console.log(desconto_);
					} else {
						//$('.campos-percentual .desconto .input-desconto input').val(desconto);
					}
					
					desconto = desconto.replace('% ','');
					
					if(!desconto) {
						desconto = 0;
					}
					
									
					var total = totalSemDesconto - (totalSemDesconto * parseFloat(desconto)/100);
					
					var descontoEmDinheiroTemp = totalSemDesconto * (parseFloat(desconto)/100);
					

					f = parseFloat(total.toFixed(2)).toLocaleString('pt-br',{style: 'currency', currency: 'BRL'});
					var totalElement = document.querySelector(".total-com-desconto");
					totalElement.innerText = f;
					
					
					var descontoEmDinheiro = parseFloat(descontoEmDinheiroTemp).toFixed(2)
					if(descontoEmDinheiroTemp.toString() == 'NaN') {
						descontoEmDinheiro = 0;
					}	
					
					
					f = parseFloat(descontoEmDinheiro).toLocaleString('pt-br',{style: 'currency', currency: 'BRL'});
					var descontoElement = document.querySelector(".desconto-em-dinheiro");
					descontoElement.innerText = f; 
					
			
					var lucroEmDinheiro = ((parseFloat(precoDeVenda) - (parseFloat(valorDeCusto)/parseFloat(precoDeVenda)) * parseFloat(precoDeVenda)) * parseFloat(quantidade)) - descontoEmDinheiro;
					f = parseFloat(lucroEmDinheiro.toFixed(2)).toLocaleString('pt-br',{style: 'currency', currency: 'BRL'});
					var lucroElement = document.querySelector(".lucro-em-dinheiro");
					lucroElement.innerText = f;
					
					if(totalSemDesconto > 0) {	
						lucroElement.innerText = f;
					} else {
						f = parseFloat('0').toLocaleString('pt-br',{style: 'currency', currency: 'BRL'});
						lucroElement.innerText = f;
					}
					
					
				} else {
						
					/*margemEmDinheiro = parseFloat(valorDeCusto) * (parseFloat(margem)/100);	
					
					var f = parseFloat(margemEmDinheiro).toLocaleString('pt-br',{style: 'currency', currency: 'BRL'});
					var margemElement = document.querySelector(".margem-em-dinheiro");
					margemElement.innerText = f;*/
					
					f = parseFloat('0').toLocaleString('pt-br',{style: 'currency', currency: 'BRL'});
					
					$('.sub-total input').val(f);
					
					
					var desconto = $('.campos-percentual .desconto input').val();
					if(desconto_) {
						desconto = desconto_;						
						$('.label-desconto').val(desconto_);
					}
					
					desconto = desconto.replace('% ','');
					
					if(!desconto) {
						desconto = 0;
					}
					
					
					var descontoElement = document.querySelector(".desconto-em-dinheiro");
					descontoElement.innerText = f;
									
					var lucroElement = document.querySelector(".lucro-em-dinheiro");
					lucroElement.innerText = f;
					
					var totalElement = document.querySelector(".total-com-desconto");
					totalElement.innerText = f;
				}
				    
				delay(function() { 
					//sendAjaxical(); 
					}, 500);
			}
			
			
			var licence = "AUSuRQp1FdcTMaMl30Lg11YKZtj3KdetC22rN+pENTU6SzFHV3gn8iVEG/AyU2MtB1DxXGhYlh6aT3r+2nFgdGFF+sZkdNmE/0Q1JNFaxGn/cjM0CGdi8ClyI2zAd35vrGrqwGEDUZLxNEEUMCmAQpAFlyh6+ZGLSWl9Hz0Cmc1K6kBTw6cLPCtGutrt5z4G6XwZ7LjDHfCHCOJwDdSQk200r9q9oh661WlR9wDzneI4zSV/TP/sHohChVNXrSUY4kD7YMnOg2SRxzBKnYYcEZxjti3ozczriAv0m9H4wSsy0PDaam5fWVSUBEg9IR2fppUSelg8gyXFMjv/mvjZdNkmiBOr8rNfQ1p1GUP+osH3yBYhOY85SFeLffsBwMY5nZ4dV8tdmlVlYhmAdt0yaK5NHfkEjiqCwUqjTBySOiWRbYBIRr8NsD6GO4bmV8Jizuj8aoZTIv3laqjnuv0vRHtv4XSEEzDSQAwEBxQF8t2NYmffHr5xvszLNYwDhJnapmwN67/q9uJbWtRU8UrkDu/NYbiRkTjhxeuG5JoM4CQdJ4rpTtWpLx1BWTsX2goYWuxjvziofsTJIpxtgdK/0DqsUWJM65kCfEiQPDaKhB0R51MyQFLSDgYAShtbZLW8OMiZAdcRHkTkimkR6OrG2OutyCuYvCGKYc0P8QYVM5SLGbwfky7e/cOur6ZVFuO0/PROzGQbxoYlTfaTIc3Cl/iIaFRTJzYVQSuEFpSD+KrwnL6j5ezqo+NGh2MrWJOGtg7aG30d8wgpDNI2XTfkvC20J/O9NAycyi8HUz+Zxm49xzJCcLvXeVILtEWD/I4OPy4=";	        
			
			var reading = false; 
			var scaning = false;
			function readBarcode() {
				
				scaning = true;

				ScanditSDK.configure(licence , {
				  engineLocation: "https://cdn.jsdelivr.net/npm/scandit-sdk@5.x/build/",
				})
				  .then(() => {
					 return test=  ScanditSDK.BarcodePicker.create(document.getElementById("scandit-barcode-picker"), {
					playSoundOnScan: true,
				  	vibrateOnScan: true,
				      // enable some common symbologies
				      scanSettings: new ScanditSDK.ScanSettings({ enabledSymbologies: ["ean8", "ean13", "upca", "upce", "code128", "code39", "code93", "itf"], codeDuplicateFilter: 1000 }),
				    });
				  })
				  .then((barcodePicker) => {
				    // barcodePicker is ready here, show a message every time a barcode is scanned
				    barcodePicker.on("scan", (scanResult) => {
				    	
				    	if(scaning) {
				    		scaning = false;
				    		
				    		if(!reading) {
					    	  reading = true;
					    	  					    	  
						      $('.field-barcode').val(scanResult.barcodes[0].data);
						      //swal({ type: 'success', title: 'Concluído!', text: scanResult.barcodes[0].data });
						      //alert(text:scanResult.barcodes[0].data);
						      
						      codigoEscaneado(scanResult.barcodes[0].data);
						      						  
				    		}
				    	}
				    	
				    });
				    				    	
				    //barcodePicker.stopScanning();
				});
			}
		</script>

	</ui:define>

</ui:composition>